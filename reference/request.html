<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Request over Context (RPC Client for Req/Rep Protocol) — request • nanonext</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Request over Context (RPC Client for Req/Rep Protocol) — request"><meta property="og:description" content="Implements a caller/client for the req node of the req/rep protocol. Sends
    data to the rep node (executor/server) and returns an Aio, which can be
    called for the value when required.
A signalling version of the function takes a 'conditionVariable' as an
    additional argument and signals it when the async receive is complete."><meta property="og:image" content="https://shikokuchuo.net/nanonext/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nanonext</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.13.2.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/nanonext.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/shikokuchuo/nanonext/" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://shikokuchuo.net/" class="external-link">
    <span class="fa fa-cube"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Request over Context (RPC Client for Req/Rep Protocol)</h1>
    <small class="dont-index">Source: <a href="https://github.com/shikokuchuo/nanonext/blob/HEAD/R/context.R" class="external-link"><code>R/context.R</code></a></small>
    <div class="hidden name"><code>request.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Implements a caller/client for the req node of the req/rep protocol. Sends
    data to the rep node (executor/server) and returns an Aio, which can be
    called for the value when required.</p>
<p>A signalling version of the function takes a 'conditionVariable' as an
    additional argument and signals it when the async receive is complete.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">request</span><span class="op">(</span></span>
<span>  <span class="va">context</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  send_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"serial"</span>, <span class="st">"raw"</span>, <span class="st">"next"</span><span class="op">)</span>,</span>
<span>  recv_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"serial"</span>, <span class="st">"character"</span>, <span class="st">"complex"</span>, <span class="st">"double"</span>, <span class="st">"integer"</span>, <span class="st">"logical"</span>,</span>
<span>    <span class="st">"numeric"</span>, <span class="st">"raw"</span>, <span class="st">"string"</span><span class="op">)</span>,</span>
<span>  timeout <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">request_signal</span><span class="op">(</span></span>
<span>  <span class="va">context</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">cv</span>,</span>
<span>  send_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"serial"</span>, <span class="st">"raw"</span>, <span class="st">"next"</span><span class="op">)</span>,</span>
<span>  recv_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"serial"</span>, <span class="st">"character"</span>, <span class="st">"complex"</span>, <span class="st">"double"</span>, <span class="st">"integer"</span>, <span class="st">"logical"</span>,</span>
<span>    <span class="st">"numeric"</span>, <span class="st">"raw"</span>, <span class="st">"string"</span><span class="op">)</span>,</span>
<span>  timeout <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>context</dt>
<dd><p>a Context.</p></dd>


<dt>data</dt>
<dd><p>an object (if send_mode = 'raw', a vector).</p></dd>


<dt>send_mode</dt>
<dd><p>[default 'serial'] character value or integer equivalent -
one of 'serial' (1L) to send serialised R objects, 'raw' (2L) to send
atomic vectors of any type as a raw byte vector, or 'next' (3L) - see
'Send Modes' section below.</p></dd>


<dt>recv_mode</dt>
<dd><p>[default 'serial'] character value or integer equivalent -
one of 'serial' (1L), 'character' (2L), 'complex' (3L), 'double' (4L),
'integer' (5L), 'logical' (6L), 'numeric' (7L), 'raw' (8L), or 'string'
(9L). The default 'serial' means a serialised R object; for the other
modes, received bytes are converted into the respective mode. 'string' is
a faster option for length one character vectors.</p></dd>


<dt>timeout</dt>
<dd><p>[default NULL] integer value in milliseconds or NULL, which
applies a socket-specific default, usually the same as no timeout.</p></dd>


<dt>cv</dt>
<dd><p><strong>For the signalling version</strong>: a 'conditionVariable' to
signal when the async receive is complete.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A 'recvAio' (object of class 'recvAio') (invisibly).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Sending the request and receiving the result are both performed async,
    hence the function will return immediately with a 'recvAio' object. Access
    the return value at <code>$data</code>.</p>
<p>This is designed so that the process on the server can run concurrently
    without blocking the client.</p>
<p>Optionally use <code><a href="call_aio.html">call_aio</a></code> on the 'recvAio' to call (and wait
    for) the result.</p>
<p>If an error occured in the server process, a nul byte <code>00</code> will be
    received. This allows an error to be easily distinguished from a NULL
    return value. <code><a href="is_error_value.html">is_nul_byte</a></code> can be used to test for a nul byte.</p>
<p>It is recommended to use a new context for each request to ensure
    consistent state tracking. For safety, the context used for the request
    is closed when all references to the returned 'recvAio' are removed and
    the object is garbage collected.</p>
<p><strong>For the signalling version</strong>: when the receive is complete,
    the supplied 'conditionVariable' is signalled by incrementing its value
    by 1. This happens asynchronously and independently of the R execution
    thread.</p>
    </div>
    <div id="send-modes">
    <h2>Send Modes</h2>
    


<p>The default mode 'serial' sends serialised R objects to ensure perfect
    reproducibility within R. When receiving, the corresponding mode 'serial'
    should be used.</p>
<p>Mode 'raw' sends atomic vectors of any type as a raw byte vector, and
    must be used when interfacing with external applications or raw system
    sockets, where R serialization is not in use. When receiving, the mode
    corresponding to the vector sent should be used.</p>
<p>Mode 'next' sends serialised R objects, with native extensions enabled by
    <code><a href="next_config.html">next_config</a></code>. This configures custom serialization and
    unserialization functions for external pointer reference objects. When
    receiving, mode 'serial' should be used as 'next' sends are fully
    compatible.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="socket.html">socket</a></span><span class="op">(</span><span class="st">"req"</span>, listen <span class="op">=</span> <span class="st">"tcp://127.0.0.1:6546"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="socket.html">socket</a></span><span class="op">(</span><span class="st">"rep"</span>, dial <span class="op">=</span> <span class="st">"tcp://127.0.0.1:6546"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># works if req and rep are running in parallel in different processes</span></span></span>
<span class="r-in"><span><span class="fu"><a href="reply.html">reply</a></span><span class="op">(</span><span class="fu"><a href="dot-context.html">.context</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span>, execute <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span>, timeout <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'errorValue' int 5 | Timed out</span>
<span class="r-in"><span><span class="va">aio</span> <span class="op">&lt;-</span> <span class="fu">request</span><span class="op">(</span><span class="fu"><a href="dot-context.html">.context</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span>, data <span class="op">=</span> <span class="fl">2022</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">aio</span><span class="op">$</span><span class="va">data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'unresolved' logi NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="close.html">close</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="close.html">close</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Signalling a condition variable</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="socket.html">socket</a></span><span class="op">(</span><span class="st">"req"</span>, listen <span class="op">=</span> <span class="st">"tcp://127.0.0.1:6546"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ctxq</span> <span class="op">&lt;-</span> <span class="fu"><a href="context.html">context</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="cv.html">cv</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">aio</span> <span class="op">&lt;-</span> <span class="fu">request_signal</span><span class="op">(</span><span class="va">ctxq</span>, data <span class="op">=</span> <span class="fl">2022</span>, cv <span class="op">=</span> <span class="va">cv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="cv.html">until</a></span><span class="op">(</span><span class="va">cv</span>, <span class="fl">10L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="close.html">close</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The following should be run in another process</span></span></span>
<span class="r-in"><span><span class="co"># rep &lt;- socket("rep", dial = "tcp://127.0.0.1:6546")</span></span></span>
<span class="r-in"><span><span class="co"># ctxp &lt;- context(rep)</span></span></span>
<span class="r-in"><span><span class="co"># reply(ctxp, execute = function(x) x + 1)</span></span></span>
<span class="r-in"><span><span class="co"># close(rep)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Charlie Gao, <img src="https://shikokuchuo.net/nanonext/reference/figures/RConsortium.png" alt="R Consortium" width="100">.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

