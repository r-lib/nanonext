<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Implements a caller/client for the req node of the req/rep protocol. Sends
    data to the rep node (executor/server) and returns an Aio, which can be
    called for the value when required.
A signalling version of the function takes a &amp;#8216;conditionVariable&amp;#8217; as an
    additional argument and signals it when the async receive is complete."><title>Request over Context (RPC Client for Req/Rep Protocol) — request • nanonext</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Request over Context (RPC Client for Req/Rep Protocol) — request"><meta property="og:description" content="Implements a caller/client for the req node of the req/rep protocol. Sends
    data to the rep node (executor/server) and returns an Aio, which can be
    called for the value when required.
A signalling version of the function takes a &amp;#8216;conditionVariable&amp;#8217; as an
    additional argument and signals it when the async receive is complete."><meta property="og:image" content="https://shikokuchuo.net/nanonext/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nanonext</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/nanonext.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/shikokuchuo/nanonext/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://shikokuchuo.net/">
    <span class="fa fa-cube"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Request over Context (RPC Client for Req/Rep Protocol)</h1>
      <small class="dont-index">Source: <a href="https://github.com/shikokuchuo/nanonext/blob/HEAD/R/context.R" class="external-link"><code>R/context.R</code></a></small>
      <div class="d-none name"><code>request.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Implements a caller/client for the req node of the req/rep protocol. Sends
    data to the rep node (executor/server) and returns an Aio, which can be
    called for the value when required.</p>
<p>A signalling version of the function takes a ‘conditionVariable’ as an
    additional argument and signals it when the async receive is complete.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">request</span><span class="op">(</span></span>
<span>  <span class="va">context</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  send_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"serial"</span>, <span class="st">"raw"</span>, <span class="st">"next"</span><span class="op">)</span>,</span>
<span>  recv_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"serial"</span>, <span class="st">"character"</span>, <span class="st">"complex"</span>, <span class="st">"double"</span>, <span class="st">"integer"</span>, <span class="st">"logical"</span>,</span>
<span>    <span class="st">"numeric"</span>, <span class="st">"raw"</span>, <span class="st">"string"</span><span class="op">)</span>,</span>
<span>  timeout <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">request_signal</span><span class="op">(</span></span>
<span>  <span class="va">context</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">cv</span>,</span>
<span>  send_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"serial"</span>, <span class="st">"raw"</span>, <span class="st">"next"</span><span class="op">)</span>,</span>
<span>  recv_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"serial"</span>, <span class="st">"character"</span>, <span class="st">"complex"</span>, <span class="st">"double"</span>, <span class="st">"integer"</span>, <span class="st">"logical"</span>,</span>
<span>    <span class="st">"numeric"</span>, <span class="st">"raw"</span>, <span class="st">"string"</span><span class="op">)</span>,</span>
<span>  timeout <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>context</dt>
<dd><p>a Context.</p></dd>


<dt>data</dt>
<dd><p>an object (if send_mode = ‘raw’, a vector).</p></dd>


<dt>send_mode</dt>
<dd><p>[default 'serial'] character value or integer equivalent -
one of ‘serial’ (1L) to send serialised R objects, ‘raw’
(2L) to send atomic vectors of any type as a raw byte vector, or
‘next’ (3L) - see ‘Send Modes’ section below.</p></dd>


<dt>recv_mode</dt>
<dd><p>[default 'serial'] character value or integer equivalent -
one of ‘serial’ (1L), ‘character’ (2L), ‘complex’
(3L), ‘double’ (4L), ‘integer’ (5L), ‘logical’ (6L),
‘numeric’ (7L), ‘raw’ (8L), or ‘string’ (9L). The
default ‘serial’ means a serialised R object; for the other
modes, received bytes are converted into the respective mode.
‘string’ is a faster option for length one character vectors.</p></dd>


<dt>timeout</dt>
<dd><p>[default NULL] integer value in milliseconds or NULL, which
applies a socket-specific default, usually the same as no timeout.</p></dd>


<dt>cv</dt>
<dd><p><strong>For the signalling version</strong>: a ‘conditionVariable’
to signal when the async receive is complete.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A ‘recvAio’ (object of class ‘recvAio’) (invisibly).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Sending the request and receiving the result are both performed
    async, hence the function will return immediately with a ‘recvAio’
    object. Access the return value at <code>$data</code>.</p>
<p>This is designed so that the process on the server can run concurrently
    without blocking the client.</p>
<p>Optionally use <code><a href="call_aio.html">call_aio</a></code> on the ‘recvAio’ to call
    (and wait for) the result.</p>
<p>If an error occured in the server process, a nul byte <code>00</code> will be
    received. This allows an error to be easily distinguished from a NULL
    return value. <code><a href="is_error_value.html">is_nul_byte</a></code> can be used to test for a nul
    byte.</p>
<p>It is recommended to use a new context for each request to ensure
    consistent state tracking. For safety, the context used for the request
    is closed when all references to the returned ‘recvAio’ are
    removed and the object is garbage collected.</p>
<p><strong>For the signalling version</strong>: when the receive is complete,
    the supplied ‘conditionVariable’ is signalled by incrementing its
    value by 1. This happens asynchronously and independently of the R
    execution thread.</p>
    </div>
    <div class="section level2">
    <h2 id="send-modes">Send Modes<a class="anchor" aria-label="anchor" href="#send-modes"></a></h2>
    


<p>The default mode ‘serial’ sends serialised R objects to ensure
    perfect reproducibility within R. When receiving, the corresponding mode
    ‘serial’ should be used.</p>
<p>Mode ‘raw’ sends atomic vectors of any type as a raw byte vector,
    and must be used when interfacing with external applications or raw
    system sockets, where R serialization is not in use. When receiving, the
    mode corresponding to the vector sent should be used.</p>
<p>Mode ‘next’ sends serialised R objects, with native extensions
    enabled by <code><a href="next_config.html">next_config</a></code>. This configures custom
    serialization and unserialization functions for reference objects. When
    receiving, mode ‘serial’ should be used as ‘next’ sends are
    fully compatible.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># works if req and rep are running in parallel in different processes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># req &lt;- socket("req", listen = "tcp://127.0.0.1:6546")</span></span></span>
<span class="r-in"><span><span class="co"># rep &lt;- socket("rep", dial = "tcp://127.0.0.1:6546")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># reply(.context(rep), execute = function(x) x + 1, timeout = 50)</span></span></span>
<span class="r-in"><span><span class="co"># aio &lt;- request(.context(req), data = 2022)</span></span></span>
<span class="r-in"><span><span class="co"># aio$data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># close(req)</span></span></span>
<span class="r-in"><span><span class="co"># close(rep)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Signalling a condition variable</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># req &lt;- socket("req", listen = "tcp://127.0.0.1:6546")</span></span></span>
<span class="r-in"><span><span class="co"># ctxq &lt;- context(req)</span></span></span>
<span class="r-in"><span><span class="co"># cv &lt;- cv()</span></span></span>
<span class="r-in"><span><span class="co"># aio &lt;- request_signal(ctxq, data = 2022, cv = cv)</span></span></span>
<span class="r-in"><span><span class="co"># until(cv, 10L)</span></span></span>
<span class="r-in"><span><span class="co"># close(req)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The following should be run in another process</span></span></span>
<span class="r-in"><span><span class="co"># rep &lt;- socket("rep", dial = "tcp://127.0.0.1:6546")</span></span></span>
<span class="r-in"><span><span class="co"># ctxp &lt;- context(rep)</span></span></span>
<span class="r-in"><span><span class="co"># reply(ctxp, execute = function(x) x + 1)</span></span></span>
<span class="r-in"><span><span class="co"># close(rep)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Charlie Gao, <img src="https://shikokuchuo.net/nanonext/reference/figures/RConsortium.png" alt="R Consortium" width="100">.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

