<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NNG (Nanomsg Next Gen) Lightweight Messaging Library • nanonext</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="NNG (Nanomsg Next Gen) Lightweight Messaging Library">
<meta property="og:description" content="R binding for NNG (Nanomsg Next Gen), a successor to ZeroMQ. NNG is 
    a socket library providing high-performance scalability protocols, a
    cross-platform standard for messaging and communications. Serves as a
    concurrency framework for building distributed applications, utilising aio
    objects which resolve automatically upon completion of asynchronous
    operations. Implements connections with transport layer security, and
    synchronisation primitives, which allow R execution to wait upon events
    being signalled by concurrent messaging threads.">
<meta property="og:image" content="https://shikokuchuo.net/nanonext/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">nanonext</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.2.9025</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/shikokuchuo/nanonext/" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://shikokuchuo.net/" class="external-link">
    <span class="fa fa-cube"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="nanonext-">nanonext <a href="https://shikokuchuo.net/nanonext/" alt="nanonext"><img src="reference/figures/logo.png" alt="nanonext logo" align="right" width="120"></a>
<a class="anchor" aria-label="anchor" href="#nanonext-"></a>
</h1></div>
<!-- badges: start -->

<p>R binding for NNG (Nanomsg Next Gen), a successor to ZeroMQ. NNG is a socket library providing high-performance scalability protocols, a cross-platform standard for messaging and communications. Serves as a concurrency framework for building distributed applications, utilising ‘aio’ objects which resolve automatically upon completion of asynchronous operations. Implements connections with transport layer security, and synchronisation primitives, which allow R execution to wait upon events being signalled by concurrent messaging threads.</p>
<p>Designed for performance and reliability, the NNG library is written in C and <a href="https://doi.org/10.5281/zenodo.7903429" class="external-link"><code>nanonext</code></a> is a lightweight zero-dependency wrapper. Provides the interface for code and processes to communicate with each other - receive data generated in Python, perform analysis in R, and send results to a C++ program – all on the same computer or on networks spanning the globe.</p>
<p>Implemented scalability protocols:</p>
<ul>
<li>Bus (mesh networks)</li>
<li>Pair (two-way radio)</li>
<li>Push/Pull (one-way pipeline)</li>
<li>Publisher/Subscriber (topics &amp; broadcast)</li>
<li>Request/Reply (RPC)</li>
<li>Surveyor/Respondent (voting &amp; service discovery)</li>
</ul>
<p>Supported transports:</p>
<ul>
<li>inproc (intra-process)</li>
<li>IPC (inter-process)</li>
<li>TCP (IPv4 or IPv6)</li>
<li>WebSocket</li>
<li>TLS (over TCP and WebSocket)</li>
</ul>
<p>Development of the TLS implementation was generously supported by the <a href="https://www.r-consortium.org/all-projects/awarded-projects/2023-group-1" alt="R Consortium ISC Grant 2023" class="external-link"><img src="reference/figures/RConsortium.png" alt="R Consortium logo" width="100"></a> .</p>
<p>Web utilities:</p>
<ul>
<li>ncurl - (async) http(s) client</li>
<li>stream - secure websockets client / generic low-level socket interface</li>
<li>messenger - console-based instant messaging with authentication</li>
<li>sha[1|224|256|384|512] - cryptographic hash and HMAC algorithms</li>
<li>base64[enc|dec] - base64 encoding and decoding</li>
</ul>
<div class="section level3">
<h3 id="table-of-contents">Table of Contents<a class="anchor" aria-label="anchor" href="#table-of-contents"></a>
</h3>
<ol style="list-style-type: decimal">
<li><a href="#installation">Installation</a></li>
<li><a href="#interfaces">Interfaces</a></li>
<li><a href="#cross-language-exchange">Cross-language Exchange</a></li>
<li><a href="#async-and-concurrency">Async and Concurrency</a></li>
<li><a href="#rpc-and-distributed-computing">RPC and Distributed Computing</a></li>
<li><a href="#synchronisation-primitives">Synchronisation Primitives</a></li>
<li><a href="#tls-secure-connections">TLS Secure Connections</a></li>
<li><a href="#publisher-subscriber-model">Publisher / Subscriber Model</a></li>
<li><a href="#surveyor-respondent-model">Surveyor / Respondent Model</a></li>
<li><a href="#ncurl-async-http-client">ncurl: (Async) HTTP Client</a></li>
<li><a href="#stream-websocket-client">stream: Websocket Client</a></li>
<li><a href="#cryptographic-hashing">Cryptographic Hashing</a></li>
<li><a href="#options-and-statistics">Options and Statistics</a></li>
<li><a href="#building-from-source">Building from Source</a></li>
<li><a href="#acknowledgements-and-links">Acknowledgements and Links</a></li>
</ol>
</div>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>Install the latest release from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"nanonext"</span><span class="op">)</span></span></code></pre></div>
<p>or the development version from rOpenSci R-universe:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"nanonext"</span>, repos <span class="op">=</span> <span class="st">"https://shikokuchuo.r-universe.dev"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interfaces">Interfaces<a class="anchor" aria-label="anchor" href="#interfaces"></a>
</h3>
<p><code>nanonext</code> offers 2 equivalent interfaces: a functional interface, and an object-oriented interface.</p>
<div class="section level4">
<h4 id="functional-interface">Functional Interface<a class="anchor" aria-label="anchor" href="#functional-interface"></a>
</h4>
<p>The primary object in the functional interface is the Socket. Use <code><a href="reference/socket.html">socket()</a></code> to create a socket and dial or listen at an address. The socket is then passed as the first argument of subsequent actions such as <code><a href="reference/send.html">send()</a></code> or <code><a href="reference/recv.html">recv()</a></code>.</p>
<p><em>Example using Request/Reply (REQ/REP) protocol with inproc transport:</em> <br> (The inproc transport uses zero-copy where possible for a much faster solution than alternatives)</p>
<p>Create sockets:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/nanonext/">nanonext</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">socket1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"req"</span>, listen <span class="op">=</span> <span class="st">"inproc://nanonext"</span><span class="op">)</span></span>
<span><span class="va">socket2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"rep"</span>, dial <span class="op">=</span> <span class="st">"inproc://nanonext"</span><span class="op">)</span></span></code></pre></div>
<p>Send message from ‘socket1’:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="va">socket1</span>, <span class="st">"hello world!"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>Receive message using ‘socket2’:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span><span class="va">socket2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "hello world!"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="object-oriented-interface">Object-oriented Interface<a class="anchor" aria-label="anchor" href="#object-oriented-interface"></a>
</h4>
<p>The primary object in the object-oriented interface is the nano object. Use <code><a href="reference/nano.html">nano()</a></code> to create a nano object which encapsulates a Socket and Dialer/Listener. Methods such as <code>$send()</code> or <code>$recv()</code> can then be accessed directly from the object.</p>
<p><em>Example using Pipeline (Push/Pull) protocol with TCP/IP transport:</em></p>
<p>Create nano objects:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/nanonext/">nanonext</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">nano1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/nano.html">nano</a></span><span class="op">(</span><span class="st">"push"</span>, listen <span class="op">=</span> <span class="st">"tcp://127.0.0.1:5555"</span><span class="op">)</span></span>
<span><span class="va">nano2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/nano.html">nano</a></span><span class="op">(</span><span class="st">"pull"</span>, dial <span class="op">=</span> <span class="st">"tcp://127.0.0.1:5555"</span><span class="op">)</span></span></code></pre></div>
<p>Send message from ‘nano1’:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nano1</span><span class="op">$</span><span class="fu">send</span><span class="op">(</span><span class="st">"hello world!"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>Receive message using ‘nano2’:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nano2</span><span class="op">$</span><span class="fu">recv</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "hello world!"</span></span></code></pre></div>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
</div>
<div class="section level3">
<h3 id="cross-language-exchange">Cross-language Exchange<a class="anchor" aria-label="anchor" href="#cross-language-exchange"></a>
</h3>
<p><code>nanonext</code> provides a fast and reliable data interface between different programming languages where NNG has an implementation, including C, C++, Java, Python, Go, Rust etc.</p>
<p>The following example demonstrates the exchange of numerical data between R and Python (NumPy), two of the most commonly-used languages for data science and machine learning.</p>
<p>Using a messaging interface provides a clean and robust approach, light on resources with limited and identifiable points of failure.</p>
<p>This approach can also serve as an interface / pipe between different processes written in the same or different languages, running on the same computer or distributed across networks, and is an enabler of modular software design as espoused by the Unix philosophy.</p>
<p>One solution it provides is that of processing real-time data where computation times exceed the data frequency - by dividing the computation into stages, this may be set up as a pipeline or ‘cascade’ of processes, each connected using NNG sockets.</p>
<p>Create socket in Python using the NNG binding ‘pynng’:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pynng</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>socket <span class="op">=</span> pynng.Pair0(listen<span class="op">=</span><span class="st">"ipc:///tmp/nanonext.socket"</span>)</span></code></pre></div>
<p>Create nano object in R using <code>nanonext</code>, then send a vector of ‘doubles’, specifying mode as ‘raw’:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/nanonext/">nanonext</a></span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/nano.html">nano</a></span><span class="op">(</span><span class="st">"pair"</span>, dial <span class="op">=</span> <span class="st">"ipc:///tmp/nanonext.socket"</span><span class="op">)</span></span>
<span><span class="va">n</span><span class="op">$</span><span class="fu">send</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">2.2</span>, <span class="fl">3.3</span>, <span class="fl">4.4</span>, <span class="fl">5.5</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>Receive in Python as a NumPy array of ‘floats’, and send back to R:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>raw <span class="op">=</span> socket.recv()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>array <span class="op">=</span> np.frombuffer(raw)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(array)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1.1 2.2 3.3 4.4 5.5]</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>msg <span class="op">=</span> array.tobytes()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>socket.send(msg)</span></code></pre></div>
<p>Receive in R, specifying the receive mode as ‘double’:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span><span class="op">$</span><span class="fu">recv</span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"double"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.1 2.2 3.3 4.4 5.5</span></span></code></pre></div>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="async-and-concurrency">Async and Concurrency<a class="anchor" aria-label="anchor" href="#async-and-concurrency"></a>
</h3>
<p><code>nanonext</code> implements true async send and receive, leveraging NNG as a massively-scaleable concurrency framework.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"pair"</span>, listen <span class="op">=</span> <span class="st">"inproc://nano"</span><span class="op">)</span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"pair"</span>, dial <span class="op">=</span> <span class="st">"inproc://nano"</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="reference/send_aio.html">send_aio()</a></code> and <code><a href="reference/recv_aio.html">recv_aio()</a></code> functions return immediately with an ‘Aio’ object, but perform their operations async.</p>
<p>An ‘Aio’ object returns an unresolved value whilst its asynchronous operation is ongoing, automatically resolving to a final value once complete.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># an async receive is requested, but no messages are waiting (yet to be sent)</span></span>
<span><span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/recv_aio.html">recv_aio</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></span>
<span><span class="va">msg</span></span>
<span><span class="co">#&gt; &lt; recvAio &gt;</span></span>
<span><span class="co">#&gt;  - $data for message data</span></span>
<span><span class="va">msg</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; ` unresolvedValue `</span></span></code></pre></div>
<p>For a ‘sendAio’ object, the result is stored at <code>$result</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/send_aio.html">send_aio</a></span><span class="op">(</span><span class="va">s1</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res</span></span>
<span><span class="co">#&gt; &lt; sendAio &gt;</span></span>
<span><span class="co">#&gt;  - $result for send result</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">result</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p><em>Note: a return value of 0 denotes a successful send, meaning that the message has been accepted by the socket for sending; the message itself may still be buffered within the system.</em></p>
<p>For a ‘recvAio’ object, the message is stored at <code>$data</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># now that a message has been sent, the 'recvAio' resolves automatically</span></span>
<span><span class="va">msg</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt;   a b</span></span>
<span><span class="co">#&gt; 1 1 2</span></span></code></pre></div>
<p>Auxiliary function <code><a href="reference/unresolved.html">unresolved()</a></code> may be used in control flow statements to perform actions which depend on resolution of the Aio, both before and after. This means there is no need to actually wait (block) for an Aio to resolve, as the example below demonstrates.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/recv_aio.html">recv_aio</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># unresolved() queries for resolution itself so no need to use it again within the while loop</span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="fu"><a href="reference/unresolved.html">unresolved</a></span><span class="op">(</span><span class="va">msg</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># do stuff before checking resolution again</span></span>
<span>  <span class="fu"><a href="reference/send_aio.html">send_aio</a></span><span class="op">(</span><span class="va">s1</span>, <span class="st">"resolved"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"unresolved"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; unresolved</span></span>
<span></span>
<span><span class="co"># perform actions which depend on the Aio value outside the while loop</span></span>
<span><span class="va">msg</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; [1] "resolved"</span></span></code></pre></div>
<p>The values may also be called explicitly using <code><a href="reference/call_aio.html">call_aio()</a></code>. This will wait for completion of the Aio (blocking).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># will wait for completion then return the resolved Aio</span></span>
<span><span class="fu"><a href="reference/call_aio.html">call_aio</a></span><span class="op">(</span><span class="va">msg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to access the resolved value directly (waiting if required)</span></span>
<span><span class="fu"><a href="reference/call_aio.html">call_aio</a></span><span class="op">(</span><span class="va">msg</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; [1] "resolved"</span></span>
<span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></span></code></pre></div>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="rpc-and-distributed-computing">RPC and Distributed Computing<a class="anchor" aria-label="anchor" href="#rpc-and-distributed-computing"></a>
</h3>
<p><code>nanonext</code> implements remote procedure calls (RPC) using NNG’s req/rep protocol to provide a basis for distributed computing.</p>
<p>Can be used to perform computationally-expensive calculations or I/O-bound operations such as writing large amounts of data to disk in a separate ‘server’ process running concurrently.</p>
<p>[S] Server process: <code><a href="reference/reply.html">reply()</a></code> will wait for a message and apply a function, in this case <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm()</a></code>, before sending back the result.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/nanonext/">nanonext</a></span><span class="op">)</span></span>
<span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"rep"</span>, listen <span class="op">=</span> <span class="st">"tcp://127.0.0.1:6546"</span><span class="op">)</span></span>
<span><span class="va">ctxp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/context.html">context</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reply.html">reply</a></span><span class="op">(</span><span class="va">ctxp</span>, execute <span class="op">=</span> <span class="va">rnorm</span>, send_mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span></code></pre></div>
<p>[C] Client process: <code><a href="reference/request.html">request()</a></code> performs an async send and receive request and returns immediately with a <code>recvAio</code> object.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/nanonext/">nanonext</a></span><span class="op">)</span></span>
<span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"req"</span>, dial <span class="op">=</span> <span class="st">"tcp://127.0.0.1:6546"</span><span class="op">)</span></span>
<span><span class="va">ctxq</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/context.html">context</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span>
<span><span class="va">aio</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/request.html">request</a></span><span class="op">(</span><span class="va">ctxq</span>, data <span class="op">=</span> <span class="fl">1e8</span>, recv_mode <span class="op">=</span> <span class="st">"double"</span><span class="op">)</span></span></code></pre></div>
<p>At this point, the client can run additional code concurrent with the server processing the request.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># do more...</span></span></code></pre></div>
<p>When the result of the server calculation is required, the <code>recvAio</code> may be called using <code><a href="reference/call_aio.html">call_aio()</a></code>.</p>
<p>The return value from the server request is then retrieved and stored in the Aio as <code>$data</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/call_aio.html">call_aio</a></span><span class="op">(</span><span class="va">aio</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aio</span></span>
<span><span class="co">#&gt; &lt; recvAio &gt;</span></span>
<span><span class="co">#&gt;  - $data for message data</span></span>
<span><span class="va">aio</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:100000000] 1.7077 -0.0516 1.1636 1.1329 -1.0902 ...</span></span></code></pre></div>
<p>As <code><a href="reference/call_aio.html">call_aio()</a></code> is blocking and will wait for completion, an alternative is to query <code>aio$data</code> directly. This will return the symbol <code>unresolvedValue</code> if the calculation is yet to complete.</p>
<p>In this example the calculation is returned, but other operations may reside entirely on the server side, for example writing data to disk.</p>
<p>In such a case, calling or querying the value confirms that the operation has completed, and provides the return value of the function, which may typically be NULL or an exit code.</p>
<p>The <a href="https://doi.org/10.5281/zenodo.7912722" class="external-link"><code>mirai</code></a> package (<a href="https://cran.r-project.org/package=mirai" class="external-link uri">https://cran.r-project.org/package=mirai</a>) uses <code>nanonext</code> as the back-end to provide asynchronous execution of arbitrary R code using the RPC model.</p>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="synchronisation-primitives">Synchronisation Primitives<a class="anchor" aria-label="anchor" href="#synchronisation-primitives"></a>
</h3>
<p><code>nanonext</code> implements cross-platform synchronisation primitives provided by the NNG library.</p>
<p>As the R interpreter runs on a single thread, synchronisation primitives such as mutexes and condition variables are not natively implemented in the R language. However, as NNG is inherently threaded and messaging can be asynchronous, it is possible to synchronise between NNG events happening independently and the main R execution thread.</p>
<p>The events that can be signalled include asynchronous receive completions, and pipe events - these are when connections are established or when they are dropped.</p>
<p>Condition variables can be used simply to record such events, or more powerfully, to wait upon these events. The condition variables implemented in <code>nanonext</code> include a both a condition (value) and flag (binary). Each signal increments the value, and each return of <code><a href="reference/cv.html">wait()</a></code> or <code><a href="reference/cv.html">until()</a></code> decrements the value. A non-zero condition allows waiting threads to continue.</p>
<p>In any situation where polling for an event presents a solution, waiting upon a condition to be signalled can be more efficient, both in terms of consuming no resources while waiting, and also being synchronised with the event (having no latency).</p>
<p>The following shows how condition variables and signalling work in practice.</p>
<p>Example 1: set up a socket, and wait for the other side to connect:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sock</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"pair"</span>, listen <span class="op">=</span> <span class="st">"inproc://nanopipe"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cv.html">cv</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># create new condition variable</span></span>
<span><span class="fu"><a href="reference/cv.html">cv_value</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="fu"><a href="reference/pipe_notify.html">pipe_notify</a></span><span class="op">(</span><span class="va">sock</span>, cv <span class="op">=</span> <span class="va">cv</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, remove <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># wait(cv) # uncomment in normal usage - but would block</span></span>
<span></span>
<span><span class="co"># for illustration:</span></span>
<span><span class="va">sock2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"pair"</span>, dial <span class="op">=</span> <span class="st">"inproc://nanopipe"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cv.html">cv_value</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span> <span class="co"># incremented when pipe to 'sock2' was created</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="fu"><a href="reference/cv.html">wait</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span> <span class="co"># wait() now does not block</span></span>
<span></span>
<span><span class="fu"><a href="reference/cv.html">cv_value</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span> <span class="co"># wait() decrements the CV value - calling wait() again will block</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">sock2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cv.html">cv_value</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span> <span class="co"># incremented when pipe to 'sock2' was destroyed</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">sock</span><span class="op">)</span></span></code></pre></div>
<p>Example 2: wait until a message is received or connection is dropped:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sock</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"pair"</span>, listen <span class="op">=</span> <span class="st">"inproc://nanosignal"</span><span class="op">)</span></span>
<span><span class="va">sock2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"pair"</span>, dial <span class="op">=</span> <span class="st">"inproc://nanosignal"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cv.html">cv</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># create new condition variable</span></span>
<span><span class="fu"><a href="reference/cv.html">cv_value</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="fu"><a href="reference/pipe_notify.html">pipe_notify</a></span><span class="op">(</span><span class="va">sock</span>, cv <span class="op">=</span> <span class="va">cv</span>, add <span class="op">=</span> <span class="cn">FALSE</span>, remove <span class="op">=</span> <span class="cn">TRUE</span>, flag <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="va">sock2</span>, <span class="st">"this message will wake waiting thread"</span><span class="op">)</span> <span class="co"># in real usage happens concurrently with wait()</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/recv_aio.html">recv_aio_signal</a></span><span class="op">(</span><span class="va">sock</span>, cv <span class="op">=</span> <span class="va">cv</span><span class="op">)</span> <span class="co"># same cv passed to signalling form of recv_aio()</span></span>
<span></span>
<span><span class="co"># wakes as soon as the asynchronous receive completes</span></span>
<span><span class="fu"><a href="reference/cv.html">wait</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span> <span class="op">||</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"peer disconnected"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">r</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; [1] "this message will wake waiting thread"</span></span>
<span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">sock</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">sock2</span><span class="op">)</span></span></code></pre></div>
<p>The above example shows the working of the flag within the condition variable. As the pipe notification was specified to raise a flag, this can be used to distinguish between a pipe event signal and a message receive signal.</p>
<p>In the case a flag is raised, <code><a href="reference/cv.html">wait()</a></code> returns FALSE rather than TRUE. So the above code will stop with the custom error message upon disconnect or else continue. This affords a way of handling disconnects that would not be possible if simply using <code><a href="reference/call_aio.html">call_aio()</a></code>, which is also a blocking wait (on a single message).</p>
<p>As can be seen, this type of mechanism presents a powerful way of waiting simulatenously on multiple events, and also distinguishing between them. <code><a href="reference/pipe_notify.html">pipe_notify()</a></code> can also be set to signal two condition variables upon each event, providing even more flexibility in creating complex concurrent applications.</p>
<p>For further details, please refer to the function documentation for <code><a href="reference/cv.html">cv()</a></code>.</p>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="tls-secure-connections">TLS Secure Connections<a class="anchor" aria-label="anchor" href="#tls-secure-connections"></a>
</h3>
<p>Secure connections are enabled through the combination of NNG and Mbed TLS libraries.</p>
<p>Authentication of endpoints and encryption of the TCP transport layer is achieved transparently by:</p>
<ol style="list-style-type: decimal">
<li>Specifying a secure <code>tls+tcp://</code> or <code>wss://</code> URL, and</li>
<li>Passing a TLS configuration object to the ‘tls’ argument of <code><a href="reference/listen.html">listen()</a></code> or <code><a href="reference/dial.html">dial()</a></code>.</li>
</ol>
<p>A TLS configuration, or ‘tlsConfig’, object is created by the <code><a href="reference/tls_config.html">tls_config()</a></code> function. Specify the argument ‘client’ to create a client configuration, and ‘server’ to create a server configuration.</p>
<p>A client configuration requires a PEM-encoded CA certificate (chain) used to verify the server identity. A server configuration requires the certificate and associated private key. These may be supplied as files or directly as character vectors. Valid X.509 certificates generated via a Certificate Signing Request to a Certificate Authority are supported in this way.</p>
<p>Additionally, the convenience function <code><a href="reference/write_cert.html">write_cert()</a></code> can automatically generate a 4096 bit RSA key pair and self-signed X.509 certificate in the format required by <code><a href="reference/tls_config.html">tls_config()</a></code>. The ‘cn’ argument must be provided and match exactly the hostname / IP address of the URL that is being used, e.g. in the example below ‘127.0.0.1’ must be used throughout, or alternatively ‘localhost’, but not a mixture of the two.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cert</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/write_cert.html">write_cert</a></span><span class="op">(</span>cn <span class="op">=</span> <span class="st">"127.0.0.1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">cert</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ server: chr [1:2] "-----BEGIN CERTIFICATE-----\nMIIFFTCCAv2gAwIBAgIBATANBgkqhkiG9w0BAQsFADAiMRIwEAYDVQQDDAkxMjcu\nMC4wLjExDDAKBgNV"| __truncated__ "-----BEGIN RSA PRIVATE KEY-----\nMIIJKAIBAAKCAgEAl2eTZxKjiV4VTDtzlFAkMEHCrJF8M/nZd3bNXd8Tesqcu3R3\n58XOjkoqrRRk"| __truncated__</span></span>
<span><span class="co">#&gt;  $ client: chr [1:2] "-----BEGIN CERTIFICATE-----\nMIIFFTCCAv2gAwIBAgIBATANBgkqhkiG9w0BAQsFADAiMRIwEAYDVQQDDAkxMjcu\nMC4wLjExDDAKBgNV"| __truncated__ ""</span></span>
<span></span>
<span><span class="va">ser</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tls_config.html">tls_config</a></span><span class="op">(</span>server <span class="op">=</span> <span class="va">cert</span><span class="op">$</span><span class="va">server</span><span class="op">)</span></span>
<span><span class="va">ser</span></span>
<span><span class="co">#&gt; &lt; TLS server configuration &gt;</span></span>
<span><span class="co">#&gt;  - auth mode: optional</span></span>
<span></span>
<span><span class="va">cli</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tls_config.html">tls_config</a></span><span class="op">(</span>client <span class="op">=</span> <span class="va">cert</span><span class="op">$</span><span class="va">client</span><span class="op">)</span></span>
<span><span class="va">cli</span></span>
<span><span class="co">#&gt; &lt; TLS client configuration &gt;</span></span>
<span><span class="co">#&gt;  - auth mode: required</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span>listen <span class="op">=</span> <span class="st">"tls+tcp://127.0.0.1:5558"</span>, tls <span class="op">=</span> <span class="va">ser</span><span class="op">)</span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span>dial <span class="op">=</span> <span class="st">"tls+tcp://127.0.0.1:5558"</span>, tls <span class="op">=</span> <span class="va">cli</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># secure TLS connection established</span></span>
<span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="publisher-subscriber-model">Publisher Subscriber Model<a class="anchor" aria-label="anchor" href="#publisher-subscriber-model"></a>
</h3>
<p><code>nanonext</code> fully implements NNG’s pub/sub protocol as per the below example. A subscriber can subscribe to one or multiple topics broadcast by a publisher.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pub</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"pub"</span>, listen <span class="op">=</span> <span class="st">"inproc://nanobroadcast"</span><span class="op">)</span></span>
<span><span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"sub"</span>, dial <span class="op">=</span> <span class="st">"inproc://nanobroadcast"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/subscribe.html">subscribe</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="st">"examples"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"examples"</span>, <span class="st">"this is an example"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"character"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "examples"           "this is an example"</span></span>
<span></span>
<span><span class="va">pub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="st">"examples at the start of a single text message"</span>, mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"character"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "examples at the start of a single text message"</span></span>
<span></span>
<span><span class="va">pub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"other"</span>, <span class="st">"this other topic will not be received"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"character"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'errorValue' int 8 | Try again</span></span>
<span></span>
<span><span class="co"># specify NULL to subscribe to ALL topics</span></span>
<span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/subscribe.html">subscribe</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">pub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"newTopic"</span>, <span class="st">"this is a new topic"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span><span class="st">"character"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "newTopic"            "this is a new topic"</span></span>
<span></span>
<span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/subscribe.html">unsubscribe</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">pub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"newTopic"</span>, <span class="st">"this topic will now not be received"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span><span class="st">"character"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'errorValue' int 8 | Try again</span></span>
<span></span>
<span><span class="co"># however the topics explicitly subscribed to are still received</span></span>
<span><span class="va">pub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"examples will still be received"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"character"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "examples will still be received"</span></span></code></pre></div>
<p>The subscribed topic can be of any atomic type (not just character), allowing integer, double, logical, complex and raw vectors to be sent and received.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/subscribe.html">subscribe</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"double"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  1 10 10 20</span></span>
<span><span class="va">pub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">sub</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"double"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'errorValue' int 8 | Try again</span></span>
<span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">pub</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">sub</span><span class="op">)</span></span></code></pre></div>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="surveyor-respondent-model">Surveyor Respondent Model<a class="anchor" aria-label="anchor" href="#surveyor-respondent-model"></a>
</h3>
<p>This type of pattern is useful for applications such as service discovery.</p>
<p>A surveyor sends a survey, which is broadcast to all peer respondents. Respondents are then able to reply, but are not obliged to. The survey itself is a timed event, and responses received after the timeout are discarded.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sur</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"surveyor"</span>, listen <span class="op">=</span> <span class="st">"inproc://nanoservice"</span><span class="op">)</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"respondent"</span>, dial <span class="op">=</span> <span class="st">"inproc://nanoservice"</span><span class="op">)</span></span>
<span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"respondent"</span>, dial <span class="op">=</span> <span class="st">"inproc://nanoservice"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sur sets a survey timeout, applying to this and subsequent surveys</span></span>
<span><span class="va">sur</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/survey_time.html">survey_time</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sur sends a message and then requests 2 async receives</span></span>
<span><span class="va">sur</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="st">"service check"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">aio1</span> <span class="op">&lt;-</span> <span class="va">sur</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv_aio.html">recv_aio</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">aio2</span> <span class="op">&lt;-</span> <span class="va">sur</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv_aio.html">recv_aio</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># res1 receives the message and replies using an aio send function</span></span>
<span><span class="va">res1</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "service check"</span></span>
<span><span class="va">res1</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send_aio.html">send_aio</a></span><span class="op">(</span><span class="st">"res1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># res2 receives the message but fails to reply</span></span>
<span><span class="va">res2</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "service check"</span></span>
<span></span>
<span><span class="co"># checking the aio - only the first will have resolved</span></span>
<span><span class="va">aio1</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; [1] "res1"</span></span>
<span><span class="va">aio2</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; ` unresolvedValue `</span></span>
<span></span>
<span><span class="co"># after the survey expires, the second resolves into a timeout error</span></span>
<span><span class="fu"><a href="reference/msleep.html">msleep</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">aio2</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; 'errorValue' int 5 | Timed out</span></span>
<span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">sur</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">res1</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">res2</span><span class="op">)</span></span></code></pre></div>
<p>Above, <code><a href="reference/msleep.html">msleep()</a></code> is an uninterruptible sleep function (utilising the NNG library), taking a time in milliseconds.</p>
<p>It can be seen that the final value resolves into a timeout, which is an integer 5 classed as ‘errorValue’. All integer error codes are classed as ‘errorValue’ to be easily distinguishable from integer message values.</p>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="ncurl-async-http-client">ncurl: Async HTTP Client<a class="anchor" aria-label="anchor" href="#ncurl-async-http-client"></a>
</h3>
<p><code><a href="reference/ncurl.html">ncurl()</a></code> is a minimalist http(s) client.</p>
<p><code><a href="reference/ncurl_aio.html">ncurl_aio()</a></code> is the async edition, performing requests asynchronously, returning immediately with an ‘ncurlAio’.</p>
<p>For normal use, it takes just the URL. It can follow redirects.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ncurl.html">ncurl</a></span><span class="op">(</span><span class="st">"https://postman-echo.com/get"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $raw</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt; [1] "{\n  \"args\": {},\n  \"headers\": {\n    \"x-forwarded-proto\": \"https\",\n    \"x-forwarded-port\": \"443\",\n    \"host\": \"postman-echo.com\",\n    \"x-amzn-trace-id\": \"Root=1-64e0f3d2-77e9939b674741a011d107db\"\n  },\n  \"url\": \"https://postman-echo.com/get\"\n}"</span></span></code></pre></div>
<p>For advanced use, supports additional HTTP methods such as POST or PUT.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ncurl_aio.html">ncurl_aio</a></span><span class="op">(</span><span class="st">"https://postman-echo.com/post"</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">"POST"</span>,</span>
<span>                 headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`Content-Type` <span class="op">=</span> <span class="st">"application/json"</span>, Authorization <span class="op">=</span> <span class="st">"Bearer APIKEY"</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="st">'{"key": "value"}'</span>,</span>
<span>                 response <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="va">res</span></span>
<span><span class="co">#&gt; &lt; ncurlAio &gt;</span></span>
<span><span class="co">#&gt;  - $status for response status code</span></span>
<span><span class="co">#&gt;  - $headers for response headers</span></span>
<span><span class="co">#&gt;  - $raw for raw message</span></span>
<span><span class="co">#&gt;  - $data for message data</span></span>
<span></span>
<span><span class="fu"><a href="reference/call_aio.html">call_aio</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">$</span><span class="va">headers</span></span>
<span><span class="co">#&gt; $date</span></span>
<span><span class="co">#&gt; [1] "Sat, 19 Aug 2023 16:54:42 GMT"</span></span>
<span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; [1] "{\n  \"args\": {},\n  \"data\": {\n    \"key\": \"value\"\n  },\n  \"files\": {},\n  \"form\": {},\n  \"headers\": {\n    \"x-forwarded-proto\": \"https\",\n    \"x-forwarded-port\": \"443\",\n    \"host\": \"postman-echo.com\",\n    \"x-amzn-trace-id\": \"Root=1-64e0f3d2-26d6e42376da10d5214b5abd\",\n    \"content-length\": \"16\",\n    \"content-type\": \"application/json\",\n    \"authorization\": \"Bearer APIKEY\"\n  },\n  \"json\": {\n    \"key\": \"value\"\n  },\n  \"url\": \"https://postman-echo.com/post\"\n}"</span></span></code></pre></div>
<p>In this respect, it may be used as a performant and lightweight method for making REST API requests.</p>
<p><code><a href="reference/ncurl_session.html">ncurl_session()</a></code> creates a re-usable open connection and presents a much faster and more efficient solution for repeated polling of an API endpoint. <code><a href="reference/ncurl_session.html">transact()</a></code> is then used to request data multiple times as required. This method allows a polling frequency that exceeds a server’s new connection limits, where this is permitted.</p>
<p>By specifying <code>convert = FALSE</code>, the received binary data is made available as a raw vector at <code>$raw</code>. This may be fed into ‘json’ parsers which can operate directly on such data etc.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sess</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ncurl_session.html">ncurl_session</a></span><span class="op">(</span><span class="st">"https://postman-echo.com/get"</span>,</span>
<span>                      convert <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`Content-Type` <span class="op">=</span> <span class="st">"application/json"</span>, Authorization <span class="op">=</span> <span class="st">"Bearer APIKEY"</span><span class="op">)</span>,</span>
<span>                      response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Date"</span>, <span class="st">"Content-Type"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sess</span></span>
<span><span class="co">#&gt; &lt; ncurlSession &gt;</span></span>
<span><span class="co">#&gt;  - use transact() to return data</span></span>
<span></span>
<span><span class="fu"><a href="reference/ncurl_session.html">transact</a></span><span class="op">(</span><span class="va">sess</span><span class="op">)</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers</span></span>
<span><span class="co">#&gt; $headers$Date</span></span>
<span><span class="co">#&gt; [1] "Sat, 19 Aug 2023 16:54:43 GMT"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$`Content-Type`</span></span>
<span><span class="co">#&gt; [1] "application/json; charset=utf-8"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $raw</span></span>
<span><span class="co">#&gt;   [1] 7b 0a 20 20 22 61 72 67 73 22 3a 20 7b 7d 2c 0a 20 20 22 68 65 61 64 65 72</span></span>
<span><span class="co">#&gt;  [26] 73 22 3a 20 7b 0a 20 20 20 20 22 78 2d 66 6f 72 77 61 72 64 65 64 2d 70 72</span></span>
<span><span class="co">#&gt;  [51] 6f 74 6f 22 3a 20 22 68 74 74 70 73 22 2c 0a 20 20 20 20 22 78 2d 66 6f 72</span></span>
<span><span class="co">#&gt;  [76] 77 61 72 64 65 64 2d 70 6f 72 74 22 3a 20 22 34 34 33 22 2c 0a 20 20 20 20</span></span>
<span><span class="co">#&gt; [101] 22 68 6f 73 74 22 3a 20 22 70 6f 73 74 6d 61 6e 2d 65 63 68 6f 2e 63 6f 6d</span></span>
<span><span class="co">#&gt; [126] 22 2c 0a 20 20 20 20 22 78 2d 61 6d 7a 6e 2d 74 72 61 63 65 2d 69 64 22 3a</span></span>
<span><span class="co">#&gt; [151] 20 22 52 6f 6f 74 3d 31 2d 36 34 65 30 66 33 64 33 2d 32 39 32 63 35 63 38</span></span>
<span><span class="co">#&gt; [176] 31 37 30 38 36 38 66 66 32 33 37 37 64 38 37 38 63 22 2c 0a 20 20 20 20 22</span></span>
<span><span class="co">#&gt; [201] 63 6f 6e 74 65 6e 74 2d 74 79 70 65 22 3a 20 22 61 70 70 6c 69 63 61 74 69</span></span>
<span><span class="co">#&gt; [226] 6f 6e 2f 6a 73 6f 6e 22 2c 0a 20 20 20 20 22 61 75 74 68 6f 72 69 7a 61 74</span></span>
<span><span class="co">#&gt; [251] 69 6f 6e 22 3a 20 22 42 65 61 72 65 72 20 41 50 49 4b 45 59 22 0a 20 20 7d</span></span>
<span><span class="co">#&gt; [276] 2c 0a 20 20 22 75 72 6c 22 3a 20 22 68 74 74 70 73 3a 2f 2f 70 6f 73 74 6d</span></span>
<span><span class="co">#&gt; [301] 61 6e 2d 65 63 68 6f 2e 63 6f 6d 2f 67 65 74 22 0a 7d</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="stream-websocket-client">stream: Websocket Client<a class="anchor" aria-label="anchor" href="#stream-websocket-client"></a>
</h3>
<p><code><a href="reference/stream.html">stream()</a></code> exposes NNG’s low-level byte stream interface for communicating with raw sockets. This may be used for connecting to arbitrary non-NNG endpoints.</p>
<p>The stream interface can be used to communicate with (secure) websocket servers. The argument <code>textframes = TRUE</code> can be specified where the websocket server uses text rather than binary frames.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># connecting to an echo service</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/stream.html">stream</a></span><span class="op">(</span>dial <span class="op">=</span> <span class="st">"wss://echo.websocket.events/"</span>, textframes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">s</span></span>
<span><span class="co">#&gt; &lt; nanoStream &gt;</span></span>
<span><span class="co">#&gt;  - type: dialer</span></span>
<span><span class="co">#&gt;  - url: wss://echo.websocket.events/</span></span>
<span><span class="co">#&gt;  - textframes: TRUE</span></span></code></pre></div>
<p><code><a href="reference/send.html">send()</a></code> and <code><a href="reference/recv.html">recv()</a></code>, as well as their asynchronous counterparts <code><a href="reference/send_aio.html">send_aio()</a></code> and <code><a href="reference/recv_aio.html">recv_aio()</a></code> can be used on Streams in the same way as Sockets. This affords a great deal of flexibility in ingesting and processing streaming data.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "echo.websocket.events sponsored by Lob.com"</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="st">"initial message"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "initial message"</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv_aio.html">recv_aio</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">r</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="st">"async message"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="st">"final message"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "final message"</span></span>
<span></span>
<span><span class="va">r</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; [1] "async message"</span></span>
<span></span>
<span><span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="cryptographic-hashing">Cryptographic Hashing<a class="anchor" aria-label="anchor" href="#cryptographic-hashing"></a>
</h3>
<p>Functions performing hashing using the SHA-1 and SHA-2 series of algorithms are included: <code><a href="reference/sha1.html">sha1()</a></code>, <code><a href="reference/sha256.html">sha224()</a></code>, <code><a href="reference/sha256.html">sha256()</a></code>, <code><a href="reference/sha256.html">sha384()</a></code> and <code><a href="reference/sha256.html">sha512()</a></code>.</p>
<p>These expose the secure, optimized implementations from the ‘Mbed TLS’ library and return a hash either directly as a raw vector or converted to a character string. For use in authentication, raw vectors can be compared directly for the highest performance.</p>
<p>To generate an HMAC (hash-based message authentication code), simply supply the value ‘key’ to use as the secret key.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/sha256.html">sha256</a></span><span class="op">(</span><span class="st">"hello world!"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "7509e5bda0c762d2bac7f90d758b5b2263fa01ccbc542ab5e3df163be08e6ca9"</span></span>
<span></span>
<span><span class="fu"><a href="reference/sha256.html">sha256</a></span><span class="op">(</span><span class="st">"hello world!"</span>, convert <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 75 09 e5 bd a0 c7 62 d2 ba c7 f9 0d 75 8b 5b 22 63 fa 01 cc bc 54 2a b5 e3</span></span>
<span><span class="co">#&gt; [26] df 16 3b e0 8e 6c a9</span></span>
<span></span>
<span><span class="fu"><a href="reference/sha256.html">sha256</a></span><span class="op">(</span><span class="st">"hello world!"</span>, key <span class="op">=</span> <span class="st">"MY_SECRET"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "d8f0e2d368ff632682d55e2c1ccd49c15f8a6a3862d8eb68f1906b6ee658890a"</span></span></code></pre></div>
<p>Optimised functions for base64 encoding and decoding from the ‘Mbed TLS’ library are also provided:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/base64enc.html">base64enc</a></span><span class="op">(</span><span class="st">"hello world!"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "aGVsbG8gd29ybGQh"</span></span>
<span></span>
<span><span class="fu"><a href="reference/base64enc.html">base64dec</a></span><span class="op">(</span><span class="fu"><a href="reference/base64enc.html">base64enc</a></span><span class="op">(</span><span class="st">"hello world!"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "hello world!"</span></span></code></pre></div>
<p>Performance is such that base64 decoding a character string into a raw vector can be faster than creating a new raw vector using <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">as.raw()</a></code>.</p>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="options-and-statistics">Options and Statistics<a class="anchor" aria-label="anchor" href="#options-and-statistics"></a>
</h3>
<p>Use <code><a href="reference/opt.html">opt()</a></code> and <code><a href="reference/opt.html">'opt&lt;-'()</a></code> to get and set options on a Socket, Context, Stream, Listener or Dialer.</p>
<p>See the function documentation page for a list of common options.</p>
<p>Once a dialer or listener has started, it is not generally possible to change its configuration. In this case, the dialer or listener should be created specifying ‘autostart = FALSE’.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span>listen <span class="op">=</span> <span class="st">"inproc://options"</span>, autostart <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># no maximum message size</span></span>
<span><span class="fu"><a href="reference/opt.html">opt</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">listener</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"recv-size-max"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="co"># enfore maximum message size to protect against denial-of-service type attacks</span></span>
<span><span class="fu"><a href="reference/opt.html">opt</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">listener</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"recv-size-max"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">8192L</span></span>
<span></span>
<span><span class="fu"><a href="reference/opt.html">opt</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">listener</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"recv-size-max"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8192</span></span>
<span></span>
<span><span class="fu"><a href="reference/start.html">start</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">listener</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Similarly <code><a href="reference/stat.html">stat()</a></code> has been implemented as the interface to NNG’s statistics framework.</p>
<p>This can be used on a Socket, Listener or Dialer to query useful statistics such as the total number of connection attempts, the current number of connections etc.</p>
<p>See the function documentation page for available statistics.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span>listen <span class="op">=</span> <span class="st">"inproc://stat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># no active connections (pipes)</span></span>
<span><span class="fu"><a href="reference/stat.html">stat</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">"pipes"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span>dial <span class="op">=</span> <span class="st">"inproc://stat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># one now that the dialer has conneceted</span></span>
<span><span class="fu"><a href="reference/stat.html">stat</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">"pipes"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="building-from-source">Building from Source<a class="anchor" aria-label="anchor" href="#building-from-source"></a>
</h3>
<div class="section level4">
<h4 id="linux--mac--solaris">Linux / Mac / Solaris<a class="anchor" aria-label="anchor" href="#linux--mac--solaris"></a>
</h4>
<p>Installation from source requires ‘libnng’ &gt;= v1.5.0 and ‘libmbedtls’ &gt;= 2.5.0 (suitable installations are automatically detected), or else ‘cmake’ to compile ‘libnng’ v1.6.0 alpha (c5e9d8a) and ‘libmbedtls’ v3.4.0 included within the package sources.</p>
<p><strong>It is recommended for optimal performance and stability to let the package automatically compile bundled versions of ‘libmbedtls’ and ‘libnng’ during installation.</strong> To always compile the libraries from source even if system installations exist, set the <code>NANONEXT_LIBS</code> environment variable prior to installation e.g. by <code>Sys.setenv(NANONEXT_LIBS = 1)</code>.</p>
<p>It is neither necessary nor recommended to install system libraries, but ‘libnng’ is available as libnng-dev (deb) or nng-devel (rpm), and ‘libmbedtls’ is available as libmbedtls-dev (deb) or libmbedtls-devel (rpm). The <code>INCLUDE_DIR</code> and <code>LIB_DIR</code> environment variables may be set prior to package installation to specify a custom location for ‘libmbedtls’ or ‘libnng’ other than the standard filesystem locations.</p>
<p><em>Additional requirements for Solaris: (i) the ‘xz’ package - available on OpenCSW, and (ii) a more recent version of ‘cmake’ than available on OpenCSW - refer to the ‘cmake’ website for the latest source file.</em></p>
</div>
<div class="section level4">
<h4 id="windows">Windows<a class="anchor" aria-label="anchor" href="#windows"></a>
</h4>
<p>For R &gt;= 4.2 using the ‘Rtools42’ or ‘Rtools43’ toolchains, ‘libnng’ v1.6.0 alpha (c5e9d8a) and ‘libmbedtls’ v3.4.0 will be automatically compiled from the package sources during installation.</p>
<p>For previous R versions, pre-compiled ‘libnng’ v1.6.0 alpha (c5e9d8a) and ‘libmbedtls’ v3.4.0 libraries are downloaded and used for installation instead.</p>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
</div>
<div class="section level3">
<h3 id="acknowledgements-and-links">Acknowledgements and Links<a class="anchor" aria-label="anchor" href="#acknowledgements-and-links"></a>
</h3>
<p>We would like to acknowledge in particular:</p>
<ul>
<li>
<a href="https://github.com/gdamore" class="external-link">Garrett D’Amore</a>, author of the NNG library, who has been generous with advice and also implemented a feature request specifically for a more efficient ‘aio’ implementation in {nanonext}.</li>
<li>The <a href="https://www.r-consortium.org/" class="external-link">R Consortium</a> for funding the development of the secure TLS capabilities in the package, and <a href="https://github.com/HenrikBengtsson" class="external-link">Henrik Bengtsson</a> and <a href="https://github.com/wlandau/" class="external-link">William Landau</a>’s roles in making this possible.</li>
<li>
<a href="https://www.r-project.org/contributors.html" class="external-link">R Core</a> for various auxiliary functions for serialisation and raw / character conversion, which have been adopted by the package.</li>
<li>
<a href="https://homepage.stat.uiowa.edu/~luke/" class="external-link">Luke Tierney</a> for documenting R’s serialization mechanism and <a href="https://github.com/coolbutuseless" class="external-link">mikefc</a> for meticulous annotations in {serializer}, which led to the package’s own implementation of a low-level interface to R serialisation.</li>
<li>
<a href="https://github.com/jeroen" class="external-link">Jeroen Ooms</a> - for his ‘Anticonf (tm)’ configure script, on which our original ‘configure’ was based, although much modified since.</li>
</ul>
<p>Links:</p>
<p><code>nanonext</code> website: <a href="https://shikokuchuo.net/nanonext/" class="uri">https://shikokuchuo.net/nanonext/</a><br><code>nanonext</code> on CRAN: <a href="https://cran.r-project.org/package=nanonext" class="external-link uri">https://cran.r-project.org/package=nanonext</a><br></p>
<p><code>nanonext</code> is listed in CRAN Task Views:<br> - High Performance Computing: <a href="https://cran.r-project.org/view=HighPerformanceComputing" class="external-link uri">https://cran.r-project.org/view=HighPerformanceComputing</a><br> - Web Technologies: <a href="https://cran.r-project.org/view=WebTechnologies" class="external-link uri">https://cran.r-project.org/view=WebTechnologies</a><br></p>
<p>NNG website: <a href="https://nng.nanomsg.org/" class="external-link uri">https://nng.nanomsg.org/</a><br> Mbed TLS website: <a href="https://www.trustedfirmware.org/projects/mbed-tls/" class="external-link uri">https://www.trustedfirmware.org/projects/mbed-tls/</a><br></p>
<p>–</p>
<p>Please note that this project is released with a <a href="https://shikokuchuo.net/nanonext/CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=nanonext" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/shikokuchuo/nanonext/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/shikokuchuo/nanonext/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing nanonext</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Charlie Gao <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-0750-061X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<img src="https://shikokuchuo.net/nanonext/reference/figures/RConsortium.png" alt="R Consortium" width="100"><br><small class="roles"> Funder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=nanonext" class="external-link"><img src="https://www.r-pkg.org/badges/version/nanonext?color=112d4e" alt="CRAN status"></a></li>
<li><a href="https://shikokuchuo.r-universe.dev" class="external-link"><img src="https://shikokuchuo.r-universe.dev/badges/nanonext?color=3f72af" alt="nanonext status badge"></a></li>
<li><a href="https://github.com/shikokuchuo/nanonext/actions" class="external-link"><img src="https://github.com/shikokuchuo/nanonext/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/shikokuchuo/nanonext" class="external-link"><img src="https://codecov.io/gh/shikokuchuo/nanonext/branch/main/graph/badge.svg" alt="codecov"></a></li>
<li><a href="https://zenodo.org/badge/latestdoi/451104675" class="external-link"><img src="https://zenodo.org/badge/451104675.svg" alt="DOI"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Charlie Gao, <img src="https://shikokuchuo.net/nanonext/reference/figures/RConsortium.png" alt="R Consortium" width="100">.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
