<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>nanonext - Web Toolkit • nanonext</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="nanonext - Web Toolkit">
<meta name="robots" content="noindex">
<script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="nanonext.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nanonext</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.7.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/nanonext.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01-messaging.html">nanonext - Messaging and Async I/O</a></li>
    <li><a class="dropdown-item" href="../articles/v02-protocols.html">nanonext - Scalability Protocols</a></li>
    <li><a class="dropdown-item" href="../articles/v03-configuration.html">nanonext - Configuration and Security</a></li>
    <li><a class="dropdown-item" href="../articles/v04-web.html">nanonext - Web Toolkit</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2025/09/nanonext-1-7-0/">nanonext 1.7.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/nanonext/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>nanonext - Web Toolkit</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/nanonext/blob/main/vignettes/v04-web.Rmd" class="external-link"><code>vignettes/v04-web.Rmd</code></a></small>
      <div class="d-none name"><code>v04-web.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nanonext.r-lib.org">nanonext</a></span><span class="op">)</span></span></code></pre></div>
<p>nanonext provides high-performance HTTP/WebSocket client and server
capabilities built on NNG’s networking stack with Mbed TLS for secure
connections.</p>
<div class="section level3">
<h3 id="http-client">1. HTTP Client<a class="anchor" aria-label="anchor" href="#http-client"></a>
</h3>
<div class="section level4">
<h4 id="ncurl-basic-requests">ncurl: Basic Requests<a class="anchor" aria-label="anchor" href="#ncurl-basic-requests"></a>
</h4>
<p><code><a href="../reference/ncurl.html">ncurl()</a></code> is a minimalist HTTP(S) client. Basic usage
requires only a URL.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ncurl.html">ncurl</a></span><span class="op">(</span><span class="st">"https://postman-echo.com/get"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt; [1] "{\"args\":{},\"headers\":{\"host\":\"postman-echo.com\",\"accept-encoding\":\"gzip, br\",\"x-forwarded-proto\":\"https\"},\"url\":\"https://postman-echo.com/get\"}"</span></span></code></pre></div>
<p>Advanced usage supports all HTTP methods (POST, PUT, DELETE, etc.),
custom headers, and request bodies.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ncurl.html">ncurl</a></span><span class="op">(</span><span class="st">"https://postman-echo.com/post"</span>,</span>
<span>      method <span class="op">=</span> <span class="st">"POST"</span>,</span>
<span>      headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`Content-Type` <span class="op">=</span> <span class="st">"application/json"</span>, Authorization <span class="op">=</span> <span class="st">"Bearer APIKEY"</span><span class="op">)</span>,</span>
<span>      data <span class="op">=</span> <span class="st">'{"key": "value"}'</span>,</span>
<span>      response <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers</span></span>
<span><span class="co">#&gt; $headers$date</span></span>
<span><span class="co">#&gt; [1] "Sun, 08 Feb 2026 11:22:45 GMT"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt; [1] "{\"args\":{},\"data\":{\"key\":\"value\"},\"files\":{},\"form\":{},\"headers\":{\"host\":\"postman-echo.com\",\"accept-encoding\":\"gzip, br\",\"x-forwarded-proto\":\"https\",\"content-type\":\"application/json\",\"authorization\":\"Bearer APIKEY\",\"content-length\":\"16\"},\"json\":{\"key\":\"value\"},\"url\":\"https://postman-echo.com/post\"}"</span></span></code></pre></div>
<p>Specify <code>response = TRUE</code> to return all response
headers.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ncurl.html">ncurl</a></span><span class="op">(</span><span class="st">"https://postman-echo.com/get"</span>,</span>
<span>      response <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers</span></span>
<span><span class="co">#&gt; $headers$Date</span></span>
<span><span class="co">#&gt; [1] "Sun, 08 Feb 2026 11:22:45 GMT"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$`Content-Type`</span></span>
<span><span class="co">#&gt; [1] "application/json; charset=utf-8"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$`Content-Length`</span></span>
<span><span class="co">#&gt; [1] "143"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$Connection</span></span>
<span><span class="co">#&gt; [1] "close"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$`CF-RAY`</span></span>
<span><span class="co">#&gt; [1] "9caac0420a1dc16b-LHR"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$etag</span></span>
<span><span class="co">#&gt; [1] "W/\"8f-7zN8nSad8A9WlFJjKQZB04z5nHE\""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$vary</span></span>
<span><span class="co">#&gt; [1] "Accept-Encoding"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$`Set-Cookie`</span></span>
<span><span class="co">#&gt; [1] "sails.sid=s%3A3tYl-iuzp8jF0j82bxVHtxrx87HF8PoG.ykEiyyCKGOB1tWjbdRBXQQN7R2JwAHxl%2FkpAWvaV%2FIs; Path=/; HttpOnly, __cf_bm=xmba.Nkum1545BuZtIF1AkAAJzxI0VLZrdSg2QarH6M-1770549765-1.0.1.1-Twtq9B6vpPFSSJbuRQ9AaEDUB83Sprl4keRU_kvVk7PZqFGUZc1cVqFvyfN14NRX1CG5qT1idcqkSWejx03q6v3KYkPgCga6vJiifoRoVUs; path=/; expires=Sun, 08-Feb-26 11:52:45 GMT; domain=.postman-echo.com; HttpOnly; Secure, _cfuvid=u2FHSl3lIzG1PMEmFIe9J58inYS1BQ8KH5f7Y3RV1Nk-1770549765548-0.0.1.1-604800000; path=/; domain=.postman-echo.com; HttpOnly; Secure; SameSite=None"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$`x-envoy-upstream-service-time`</span></span>
<span><span class="co">#&gt; [1] "5"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$`cf-cache-status`</span></span>
<span><span class="co">#&gt; [1] "DYNAMIC"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$Server</span></span>
<span><span class="co">#&gt; [1] "cloudflare"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt; [1] "{\"args\":{},\"headers\":{\"host\":\"postman-echo.com\",\"accept-encoding\":\"gzip, br\",\"x-forwarded-proto\":\"https\"},\"url\":\"https://postman-echo.com/get\"}"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="ncurl_aio-async-requests">ncurl_aio: Async Requests<a class="anchor" aria-label="anchor" href="#ncurl_aio-async-requests"></a>
</h4>
<p><code><a href="../reference/ncurl_aio.html">ncurl_aio()</a></code> performs asynchronous requests, returning
immediately with an ‘ncurlAio’ object that resolves when the response
arrives.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ncurl_aio.html">ncurl_aio</a></span><span class="op">(</span><span class="st">"https://postman-echo.com/post"</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">"POST"</span>,</span>
<span>                 headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`Content-Type` <span class="op">=</span> <span class="st">"application/json"</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="st">'{"async": true}'</span>,</span>
<span>                 response <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="va">res</span></span>
<span><span class="co">#&gt; &lt; ncurlAio | $status $headers $data &gt;</span></span>
<span></span>
<span><span class="fu"><a href="../reference/call_aio.html">call_aio</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">$</span><span class="va">headers</span></span>
<span><span class="co">#&gt; $date</span></span>
<span><span class="co">#&gt; [1] "Sun, 08 Feb 2026 11:22:45 GMT"</span></span>
<span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; [1] "{\"args\":{},\"data\":{\"async\":true},\"files\":{},\"form\":{},\"headers\":{\"host\":\"postman-echo.com\",\"content-type\":\"application/json\",\"accept-encoding\":\"gzip, br\",\"x-forwarded-proto\":\"https\",\"content-length\":\"15\"},\"json\":{\"async\":true},\"url\":\"https://postman-echo.com/post\"}"</span></span></code></pre></div>
<div class="section level5">
<h5 id="promises-integration">Promises Integration<a class="anchor" aria-label="anchor" href="#promises-integration"></a>
</h5>
<p>‘ncurlAio’ objects work anywhere that accepts a ‘promise’ from the
promises package, including Shiny ExtendedTask.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/promises/" class="external-link">promises</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ncurl_aio.html">ncurl_aio</a></span><span class="op">(</span><span class="st">"https://postman-echo.com/get"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rstudio.github.io/promises/reference/then.html" class="external-link">then</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/promises/reference/is.promise.html" class="external-link">is.promise</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="ncurl_session-persistent-connections">ncurl_session: Persistent Connections<a class="anchor" aria-label="anchor" href="#ncurl_session-persistent-connections"></a>
</h4>
<p><code><a href="../reference/ncurl_session.html">ncurl_session()</a></code> creates a reusable connection for
efficient repeated requests to an API endpoint. Use
<code><a href="../reference/ncurl_session.html">transact()</a></code> to send requests over the session.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sess</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ncurl_session.html">ncurl_session</a></span><span class="op">(</span><span class="st">"https://postman-echo.com/get"</span>,</span>
<span>                      convert <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`Content-Type` <span class="op">=</span> <span class="st">"application/json"</span><span class="op">)</span>,</span>
<span>                      response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Date"</span>, <span class="st">"Content-Type"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sess</span></span>
<span><span class="co">#&gt; &lt; ncurlSession &gt; - transact() to return data</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ncurl_session.html">transact</a></span><span class="op">(</span><span class="va">sess</span><span class="op">)</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers</span></span>
<span><span class="co">#&gt; $headers$Date</span></span>
<span><span class="co">#&gt; [1] "Sun, 08 Feb 2026 11:22:46 GMT"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $headers$`Content-Type`</span></span>
<span><span class="co">#&gt; [1] "application/json; charset=utf-8"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt;   [1] 7b 22 61 72 67 73 22 3a 7b 7d 2c 22 68 65 61 64 65 72 73 22 3a 7b 22 68 6f 73 74 22 3a</span></span>
<span><span class="co">#&gt;  [30] 22 70 6f 73 74 6d 61 6e 2d 65 63 68 6f 2e 63 6f 6d 22 2c 22 61 63 63 65 70 74 2d 65 6e</span></span>
<span><span class="co">#&gt;  [59] 63 6f 64 69 6e 67 22 3a 22 67 7a 69 70 2c 20 62 72 22 2c 22 78 2d 66 6f 72 77 61 72 64</span></span>
<span><span class="co">#&gt;  [88] 65 64 2d 70 72 6f 74 6f 22 3a 22 68 74 74 70 73 22 2c 22 63 6f 6e 74 65 6e 74 2d 74 79</span></span>
<span><span class="co">#&gt; [117] 70 65 22 3a 22 61 70 70 6c 69 63 61 74 69 6f 6e 2f 6a 73 6f 6e 22 7d 2c 22 75 72 6c 22</span></span>
<span><span class="co">#&gt; [146] 3a 22 68 74 74 70 73 3a 2f 2f 70 6f 73 74 6d 61 6e 2d 65 63 68 6f 2e 63 6f 6d 2f 67 65</span></span>
<span><span class="co">#&gt; [175] 74 22 7d</span></span>
<span></span>
<span><span class="fu"><a href="../reference/close.html">close</a></span><span class="op">(</span><span class="va">sess</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="websocket-client">2. WebSocket Client<a class="anchor" aria-label="anchor" href="#websocket-client"></a>
</h3>
<p><code><a href="../reference/stream.html">stream()</a></code> provides a low-level byte stream interface for
communicating with WebSocket servers and other non-NNG endpoints.</p>
<p>Use <code>textframes = TRUE</code> for servers that expect text
frames (most WebSocket servers).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stream.html">stream</a></span><span class="op">(</span>dial <span class="op">=</span> <span class="st">"wss://echo.websocket.org/"</span>, textframes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">s</span></span>
<span><span class="co">#&gt; &lt; nanoStream &gt;</span></span>
<span><span class="co">#&gt;  - mode: dialer text frames</span></span>
<span><span class="co">#&gt;  - state: opened</span></span>
<span><span class="co">#&gt;  - url: wss://echo.websocket.org/</span></span></code></pre></div>
<p><code><a href="../reference/send.html">send()</a></code> and <code><a href="../reference/recv.html">recv()</a></code>, along with their async
counterparts <code><a href="../reference/send_aio.html">send_aio()</a></code> and <code><a href="../reference/recv_aio.html">recv_aio()</a></code>, work
on Streams just like Sockets.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/recv.html">recv</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Request served by 4d896d95b55478"</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/send.html">send</a></span><span class="op">(</span><span class="st">"hello websocket"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/recv.html">recv</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "hello websocket"</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/recv_aio.html">recv_aio</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">r</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/send.html">send</a></span><span class="op">(</span><span class="st">"async message"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="va">r</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "async message"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/close.html">close</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="unified-httpwebsocket-server">3. Unified HTTP/WebSocket Server<a class="anchor" aria-label="anchor" href="#unified-httpwebsocket-server"></a>
</h3>
<p><code><a href="../reference/http_server.html">http_server()</a></code> creates a single server that can handle
HTTP requests, WebSocket connections, and HTTP streaming, all on the
same port.</p>
<p>A single call to <code><a href="../reference/http_server.html">http_server()</a></code> sets up one NNG server
instance with a list of handlers. HTTP routes, WebSocket endpoints,
streaming endpoints, and static file handlers all share the same
underlying server – there is no need to run separate processes or bind
additional ports. WebSocket clients connect via the standard HTTP
upgrade mechanism, so a browser can load a page over HTTP and open a
WebSocket connection to the same origin without any cross-origin
configuration.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/http_server.html">http_server</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">"http://127.0.0.1:8080"</span>,</span>
<span>  handlers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/handler.html">handler</a></span><span class="op">(</span><span class="st">"/"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">200L</span>, body <span class="op">=</span> <span class="st">"Hello from nanonext!"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/handler.html">handler</a></span><span class="op">(</span><span class="st">"/api/data"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        status <span class="op">=</span> <span class="fl">200L</span>,</span>
<span>        headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Content-Type"</span> <span class="op">=</span> <span class="st">"application/json"</span><span class="op">)</span>,</span>
<span>        body <span class="op">=</span> <span class="st">'{"value": 42}'</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>, method <span class="op">=</span> <span class="st">"GET"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">server</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Process requests: repeat later::run_now(Inf)</span></span>
<span><span class="va">server</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Specifying port <code>0</code> in the URL lets the OS assign an
available port. The actual port is reflected in <code>server$url</code>
after <code>$start()</code>, making it easy to set up test servers
without port conflicts.</p>
<div class="section level4">
<h4 id="handler-types">Handler Types<a class="anchor" aria-label="anchor" href="#handler-types"></a>
</h4>
<p>All handler types can be freely mixed in a single server’s handler
list:</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th align="left">Handler</th>
<th align="left">Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code><a href="../reference/handler.html">handler()</a></code></td>
<td align="left">HTTP request/response with R callback</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/handler_ws.html">handler_ws()</a></code></td>
<td align="left">WebSocket with <code>on_message</code>,
<code>on_open</code>, <code>on_close</code> callbacks</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/handler_stream.html">handler_stream()</a></code></td>
<td align="left">Chunked HTTP streaming (SSE, NDJSON, custom)</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/handler_file.html">handler_file()</a></code></td>
<td align="left">Serve a single static file</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/handler_directory.html">handler_directory()</a></code></td>
<td align="left">Serve a directory tree with automatic MIME types</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/handler_inline.html">handler_inline()</a></code></td>
<td align="left">Serve in-memory content</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/handler_redirect.html">handler_redirect()</a></code></td>
<td align="left">HTTP redirect</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="http-request-handlers">HTTP Request Handlers<a class="anchor" aria-label="anchor" href="#http-request-handlers"></a>
</h4>
<p><code><a href="../reference/handler.html">handler()</a></code> creates HTTP route handlers. The callback
receives a request list with <code>method</code>, <code>uri</code>,
<code>headers</code>, and <code>body</code>, and returns a response list
with <code>status</code>, optional <code>headers</code>, and
<code>body</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># GET endpoint</span></span>
<span><span class="va">h1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/handler.html">handler</a></span><span class="op">(</span><span class="st">"/hello"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">200L</span>, body <span class="op">=</span> <span class="st">"Hello!"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># POST endpoint echoing the request body</span></span>
<span><span class="va">h2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/handler.html">handler</a></span><span class="op">(</span><span class="st">"/echo"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">200L</span>, body <span class="op">=</span> <span class="va">req</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></span>
<span><span class="op">}</span>, method <span class="op">=</span> <span class="st">"POST"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Catch-all for any method under a path prefix</span></span>
<span><span class="va">h3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/handler.html">handler</a></span><span class="op">(</span><span class="st">"/api"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    status <span class="op">=</span> <span class="fl">200L</span>,</span>
<span>    headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Content-Type"</span> <span class="op">=</span> <span class="st">"application/json"</span><span class="op">)</span>,</span>
<span>    body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">'{"method":"%s","uri":"%s"}'</span>, <span class="va">req</span><span class="op">$</span><span class="va">method</span>, <span class="va">req</span><span class="op">$</span><span class="va">uri</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span>, method <span class="op">=</span> <span class="st">"*"</span>, prefix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="static-content-handlers">Static Content Handlers<a class="anchor" aria-label="anchor" href="#static-content-handlers"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Serve a single file</span></span>
<span><span class="va">h_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/handler_file.html">handler_file</a></span><span class="op">(</span><span class="st">"/favicon.ico"</span>, <span class="st">"path/to/favicon.ico"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Serve a directory tree (automatic MIME type detection)</span></span>
<span><span class="va">h_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/handler_directory.html">handler_directory</a></span><span class="op">(</span><span class="st">"/static"</span>, <span class="st">"www/assets"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Serve inline content</span></span>
<span><span class="va">h_inline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/handler_inline.html">handler_inline</a></span><span class="op">(</span><span class="st">"/robots.txt"</span>, <span class="st">"User-agent: *\nDisallow:"</span>,</span>
<span>                           content_type <span class="op">=</span> <span class="st">"text/plain"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Redirect requests</span></span>
<span><span class="va">h_redirect</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/handler_redirect.html">handler_redirect</a></span><span class="op">(</span><span class="st">"/old-page"</span>, <span class="st">"/new-page"</span>, status <span class="op">=</span> <span class="fl">301L</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="websocket-handlers">WebSocket Handlers<a class="anchor" aria-label="anchor" href="#websocket-handlers"></a>
</h4>
<p>WebSockets provide full bidirectional communication – the server can
push messages to the client, and the client can send messages back.</p>
<p><code><a href="../reference/handler_ws.html">handler_ws()</a></code> creates WebSocket endpoints. NNG handles
the HTTP upgrade handshake and all WebSocket framing (RFC 6455)
automatically. Because WebSocket handlers share the same server as HTTP
handlers, the browser can load a page and open a WebSocket to the same
host and port with no additional setup.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/http_server.html">http_server</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">"http://127.0.0.1:8080"</span>,</span>
<span>  handlers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/handler_ws.html">handler_ws</a></span><span class="op">(</span></span>
<span>      <span class="st">"/chat"</span>,</span>
<span>      on_message <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ws</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># Broadcast to all connected clients</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">client</span> <span class="kw">in</span> <span class="va">clients</span><span class="op">)</span> <span class="va">client</span><span class="op">$</span><span class="fu">send</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>      <span class="op">}</span>,</span>
<span>      on_open <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ws</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">clients</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">ws</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="va">ws</span></span>
<span>      <span class="op">}</span>,</span>
<span>      on_close <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ws</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">clients</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">ws</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="cn">NULL</span></span>
<span>      <span class="op">}</span>,</span>
<span>      textframes <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">server</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The <code>ws</code> connection object provides:</p>
<ul>
<li>
<code>ws$send(data)</code> - Send a message to the client</li>
<li>
<code>ws$close()</code> - Close the connection</li>
<li>
<code>ws$id</code> - Unique integer connection identifier</li>
</ul>
<p>Multiple WebSocket endpoints can coexist on the same server, each
with independent callbacks and connection tracking. Connection IDs are
unique across the entire server, so they are safe to use as keys in a
shared data structure spanning multiple handlers.</p>
</div>
<div class="section level4">
<h4 id="http-streaming-handlers">HTTP Streaming Handlers<a class="anchor" aria-label="anchor" href="#http-streaming-handlers"></a>
</h4>
<p>When you only need to push data in one direction – server to client –
streaming is a lighter-weight alternative to WebSockets. It works over
plain HTTP, so any client that speaks HTTP can consume the stream
without needing a WebSocket library.</p>
<p><code><a href="../reference/handler_stream.html">handler_stream()</a></code> enables HTTP streaming using chunked
transfer encoding, supporting Server-Sent Events (SSE),
newline-delimited JSON (NDJSON), and custom streaming formats. Like
WebSocket handlers, streaming endpoints share the same server as all
other handlers.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/http_server.html">http_server</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">"http://127.0.0.1:8080"</span>,</span>
<span>  handlers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># SSE endpoint</span></span>
<span>    <span class="fu"><a href="../reference/handler_stream.html">handler_stream</a></span><span class="op">(</span><span class="st">"/events"</span>,</span>
<span>      on_request <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">conn</span>, <span class="va">req</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">conn</span><span class="op">$</span><span class="fu">set_header</span><span class="op">(</span><span class="st">"Content-Type"</span>, <span class="st">"text/event-stream"</span><span class="op">)</span></span>
<span>        <span class="va">conn</span><span class="op">$</span><span class="fu">set_header</span><span class="op">(</span><span class="st">"Cache-Control"</span>, <span class="st">"no-cache"</span><span class="op">)</span></span>
<span>        <span class="va">conns</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">conn</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="va">conn</span></span>
<span>        <span class="va">conn</span><span class="op">$</span><span class="fu">send</span><span class="op">(</span><span class="fu"><a href="../reference/format_sse.html">format_sse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="st">"connected"</span>, id <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span>,</span>
<span>      on_close <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">conn</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">conns</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">conn</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="cn">NULL</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># Trigger broadcast via POST</span></span>
<span>    <span class="fu"><a href="../reference/handler.html">handler</a></span><span class="op">(</span><span class="st">"/broadcast"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_sse.html">format_sse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html" class="external-link">rawToChar</a></span><span class="op">(</span><span class="va">req</span><span class="op">$</span><span class="va">body</span><span class="op">)</span>, event <span class="op">=</span> <span class="st">"message"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">conns</span>, <span class="kw">function</span><span class="op">(</span><span class="va">c</span><span class="op">)</span> <span class="va">c</span><span class="op">$</span><span class="fu">send</span><span class="op">(</span><span class="va">msg</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">200L</span>, body <span class="op">=</span> <span class="st">"sent"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, method <span class="op">=</span> <span class="st">"POST"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">server</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="server-sent-events">Server-Sent Events<a class="anchor" aria-label="anchor" href="#server-sent-events"></a>
</h4>
<p><code><a href="../reference/format_sse.html">format_sse()</a></code> formats messages according to the SSE
specification for browser <code>EventSource</code> clients.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/format_sse.html">format_sse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="st">"Hello"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "data: Hello\n\n"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/format_sse.html">format_sse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="st">"Update available"</span>, event <span class="op">=</span> <span class="st">"notification"</span>, id <span class="op">=</span> <span class="st">"42"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "event: notification\nid: 42\ndata: Update available\n\n"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/format_sse.html">format_sse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="st">"Line 1\nLine 2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "data: Line 1\ndata: Line 2\n\n"</span></span></code></pre></div>
<p>The streaming connection object provides:</p>
<ul>
<li>
<code>conn$send(data)</code> - Send a data chunk</li>
<li>
<code>conn$close()</code> - Close the connection</li>
<li>
<code>conn$set_status(code)</code> - Set HTTP status (before first
send)</li>
<li>
<code>conn$set_header(name, value)</code> - Set response header
(before first send)</li>
<li>
<code>conn$id</code> - Unique connection identifier</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="secure-connections-tls">4. Secure Connections (TLS)<a class="anchor" aria-label="anchor" href="#secure-connections-tls"></a>
</h3>
<p>All web functions support TLS for secure HTTPS/WSS connections via
<code><a href="../reference/tls_config.html">tls_config()</a></code>.</p>
<div class="section level4">
<h4 id="public-internet-https">Public Internet HTTPS<a class="anchor" aria-label="anchor" href="#public-internet-https"></a>
</h4>
<p>When making HTTPS requests over the public internet, you should
supply a TLS configuration to validate server certificates.</p>
<p>Root CA certificates in PEM format may be found at:</p>
<ul>
<li>Linux: <code>/etc/ssl/certs/ca-certificates.crt</code> or
<code>/etc/pki/tls/certs/ca-bundle.crt</code>
</li>
<li>macOS: <code>/etc/ssl/cert.pem</code>
</li>
<li>Windows: download from the <a href="https://www.ccadb.org/resources" class="external-link">Common CA Database</a> site run
by Mozilla (select the Server Authentication SSL/TLS certificates text
file). <em>This link is not endorsed; use at your own risk.</em>
</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tls_config.html">tls_config</a></span><span class="op">(</span>client <span class="op">=</span> <span class="st">"/etc/ssl/cert.pem"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ncurl.html">ncurl</a></span><span class="op">(</span><span class="st">"https://www.google.com"</span>, tls <span class="op">=</span> <span class="va">tls</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="self-signed-certificates">Self-Signed Certificates<a class="anchor" aria-label="anchor" href="#self-signed-certificates"></a>
</h4>
<p>For internal services or testing, generate self-signed certificates
using <code><a href="../reference/write_cert.html">write_cert()</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate self-signed certificate for testing</span></span>
<span><span class="va">cert</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_cert.html">write_cert</a></span><span class="op">(</span>cn <span class="op">=</span> <span class="st">"127.0.0.1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Server TLS configuration</span></span>
<span><span class="va">ser</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tls_config.html">tls_config</a></span><span class="op">(</span>server <span class="op">=</span> <span class="va">cert</span><span class="op">$</span><span class="va">server</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Client TLS configuration</span></span>
<span><span class="va">cli</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tls_config.html">tls_config</a></span><span class="op">(</span>client <span class="op">=</span> <span class="va">cert</span><span class="op">$</span><span class="va">client</span><span class="op">)</span></span></code></pre></div>
<p>Use the configurations with servers and clients:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># HTTPS server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/http_server.html">http_server</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">"https://127.0.0.1:0"</span>,</span>
<span>  handlers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/handler.html">handler</a></span><span class="op">(</span><span class="st">"/"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">200L</span>, body <span class="op">=</span> <span class="st">"Secure!"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  tls <span class="op">=</span> <span class="va">ser</span></span>
<span><span class="op">)</span></span>
<span><span class="va">server</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">server</span></span>
<span><span class="co">#&gt; &lt; nanoServer &gt;</span></span>
<span><span class="co">#&gt;  - url: https://127.0.0.1:50715 </span></span>
<span><span class="co">#&gt;  - state: started</span></span>
<span></span>
<span><span class="co"># HTTPS client request</span></span>
<span><span class="va">aio</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ncurl_aio.html">ncurl_aio</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">server</span><span class="op">$</span><span class="va">url</span>, <span class="st">"/"</span><span class="op">)</span>, tls <span class="op">=</span> <span class="va">cli</span><span class="op">)</span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="fu"><a href="../reference/unresolved.html">unresolved</a></span><span class="op">(</span><span class="va">aio</span><span class="op">)</span><span class="op">)</span> <span class="fu">later</span><span class="fu">::</span><span class="fu"><a href="https://later.r-lib.org/reference/run_now.html" class="external-link">run_now</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"args":{},"headers":{"host":"postman-echo.com","accept-encoding":"gzip, br","x-forwarded-proto":"https"},"url":"https://postman-echo.com/get"}</span></span>
<span><span class="va">aio</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="va">aio</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt; [1] "Secure!"</span></span>
<span></span>
<span><span class="va">server</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="client-example-shiny-extendedtask">5. Client Example: Shiny ExtendedTask<a class="anchor" aria-label="anchor" href="#client-example-shiny-extendedtask"></a>
</h3>
<p>This example demonstrates using <code><a href="../reference/ncurl_aio.html">ncurl_aio()</a></code> with Shiny’s
ExtendedTask for non-blocking HTTP requests.</p>
<p>If your Shiny app calls an external API, a slow or unresponsive
endpoint will block the R process and freeze the app for <em>all</em>
users, not just the one who triggered the request.
<code><a href="../reference/ncurl_aio.html">ncurl_aio()</a></code> avoids this – it performs the HTTP call on a
background thread and returns a promise, so the R process stays free to
serve other sessions. It works anywhere that accepts a promise,
including Shiny’s ExtendedTask:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/bslib/" class="external-link">bslib</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nanonext.r-lib.org">nanonext</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/page.html" class="external-link">page_fluid</a></span><span class="op">(</span></span>
<span>  <span class="fu">p</span><span class="op">(</span><span class="st">"The time is "</span>, <span class="fu">textOutput</span><span class="op">(</span><span class="st">"current_time"</span>, inline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">hr</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rstudio.github.io/bslib/reference/input_task_button.html" class="external-link">input_task_button</a></span><span class="op">(</span><span class="st">"btn"</span>, <span class="st">"Fetch data"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu">verbatimTextOutput</span><span class="op">(</span><span class="st">"result"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">current_time</span> <span class="op">&lt;-</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">invalidateLater</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%H:%M:%S %p"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">task</span> <span class="op">&lt;-</span> <span class="va">ExtendedTask</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="../reference/ncurl_aio.html">ncurl_aio</a></span><span class="op">(</span><span class="st">"https://postman-echo.com/get"</span>, response <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bind_task_button.html" class="external-link">bind_task_button</a></span><span class="op">(</span><span class="st">"btn"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">btn</span>, <span class="va">task</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">renderPrint</span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="fu">result</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">headers</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">shinyApp</span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="server-example-quarto-site-with-dynamic-api">6. Server Example: Quarto Site with Dynamic API<a class="anchor" aria-label="anchor" href="#server-example-quarto-site-with-dynamic-api"></a>
</h3>
<p>This example shows how the unified server architecture makes it
straightforward to combine HTTP or WebSocket handlers to serve different
content over the same port.</p>
<p>If you’ve rendered a Quarto website and want to serve it locally –
but also expose a dynamic API endpoint alongside it, that’s possible
with a single <code><a href="../reference/http_server.html">http_server()</a></code> call:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nanonext.r-lib.org">nanonext</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/http_server.html">http_server</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">"http://127.0.0.1:0"</span>,</span>
<span>  handlers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Serve your rendered Quarto site</span></span>
<span>    <span class="fu"><a href="../reference/handler_directory.html">handler_directory</a></span><span class="op">(</span><span class="st">"/"</span>, <span class="st">"_site"</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># Add a prediction API endpoint</span></span>
<span>    <span class="fu"><a href="../reference/handler.html">handler</a></span><span class="op">(</span><span class="st">"/api/predict"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">input</span> <span class="op">&lt;-</span> <span class="fu">secretbase</span><span class="fu">::</span><span class="fu">jsondec</span><span class="op">(</span><span class="va">req</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></span>
<span>      <span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="va">input</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        status <span class="op">=</span> <span class="fl">200L</span>,</span>
<span>        headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Content-Type"</span> <span class="op">=</span> <span class="st">"application/json"</span><span class="op">)</span>,</span>
<span>        body <span class="op">=</span> <span class="fu">secretbase</span><span class="fu">::</span><span class="fu">jsonenc</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prediction <span class="op">=</span> <span class="va">pred</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>, method <span class="op">=</span> <span class="st">"POST"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">server</span><span class="op">$</span><span class="va">url</span></span>
<span><span class="co"># Browse to the URL to see your Quarto site with a live API behind it</span></span></code></pre></div>
<p>Static pages are served at native speed by NNG while the prediction
endpoint is handled by R – no separate processes or ports required.
Adding TLS is a single argument.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/shikokuchuo" class="external-link">Charlie Gao</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>, <img src="https://r-consortium.org/images/RConsortium_Horizontal_Pantone.webp" alt="R Consortium" width="100" height="22">.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
