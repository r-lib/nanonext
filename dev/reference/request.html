<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Request over Context (RPC Client for Req/Rep Protocol) — request • nanonext</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Request over Context (RPC Client for Req/Rep Protocol) — request"><meta name="description" content="Implements a caller/client for the req node of the req/rep protocol. Sends
    data to the rep node (executor/server) and returns an Aio, which can be
    called for the value when required."><meta property="og:description" content="Implements a caller/client for the req node of the req/rep protocol. Sends
    data to the rep node (executor/server) and returns an Aio, which can be
    called for the value when required."><meta property="og:image" content="https://shikokuchuo.net/nanonext/logo.png"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nanonext</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1.9015</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/nanonext.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/shikokuchuo/nanonext/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://shikokuchuo.net/" aria-label="shikokuchuo"><span class="fa fa-cube"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Request over Context (RPC Client for Req/Rep Protocol)</h1>
      <small class="dont-index">Source: <a href="https://github.com/shikokuchuo/nanonext/blob/main/R/context.R" class="external-link"><code>R/context.R</code></a></small>
      <div class="d-none name"><code>request.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Implements a caller/client for the req node of the req/rep protocol. Sends
    data to the rep node (executor/server) and returns an Aio, which can be
    called for the value when required.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">request</span><span class="op">(</span></span>
<span>  <span class="va">context</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  send_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"serial"</span>, <span class="st">"raw"</span><span class="op">)</span>,</span>
<span>  recv_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"serial"</span>, <span class="st">"character"</span>, <span class="st">"complex"</span>, <span class="st">"double"</span>, <span class="st">"integer"</span>, <span class="st">"logical"</span>,</span>
<span>    <span class="st">"numeric"</span>, <span class="st">"raw"</span>, <span class="st">"string"</span><span class="op">)</span>,</span>
<span>  timeout <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cv <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-context">context<a class="anchor" aria-label="anchor" href="#arg-context"></a></dt>
<dd><p>a Context.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>an object (if send_mode = ‘raw’, a vector).</p></dd>


<dt id="arg-send-mode">send_mode<a class="anchor" aria-label="anchor" href="#arg-send-mode"></a></dt>
<dd><p>[default 'serial'] character value or integer equivalent -
either ‘serial’ (1L) to send serialised R objects, or ‘raw’
(2L) to send atomic vectors of any type as a raw byte vector.</p></dd>


<dt id="arg-recv-mode">recv_mode<a class="anchor" aria-label="anchor" href="#arg-recv-mode"></a></dt>
<dd><p>[default 'serial'] character value or integer equivalent -
one of ‘serial’ (1L), ‘character’ (2L), ‘complex’
(3L), ‘double’ (4L), ‘integer’ (5L), ‘logical’ (6L),
‘numeric’ (7L), ‘raw’ (8L), or ‘string’ (9L). The
default ‘serial’ means a serialised R object; for the other
modes, received bytes are converted into the respective mode.
‘string’ is a faster option for length one character vectors.</p></dd>


<dt id="arg-timeout">timeout<a class="anchor" aria-label="anchor" href="#arg-timeout"></a></dt>
<dd><p>[default NULL] integer value in milliseconds or NULL, which
applies a socket-specific default, usually the same as no timeout.</p></dd>


<dt id="arg-cv">cv<a class="anchor" aria-label="anchor" href="#arg-cv"></a></dt>
<dd><p>(optional) a ‘conditionVariable’ to signal when the async
receive is complete, or NULL. If any other value is supplied, this will
cause the pipe connection to be dropped when the async receive is
complete.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A ‘recvAio’ (object of class ‘mirai’ and
    ‘recvAio’) (invisibly).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Sending the request and receiving the result are both performed
    async, hence the function will return immediately with a ‘recvAio’
    object. Access the return value at <code>$data</code>.</p>
<p>This is designed so that the process on the server can run concurrently
    without blocking the client.</p>
<p>Optionally use <code><a href="call_aio.html">call_aio</a></code> on the ‘recvAio’ to call
    (and wait for) the result.</p>
<p>If an error occured in the server process, a nul byte <code>00</code> will be
    received. This allows an error to be easily distinguished from a NULL
    return value. <code><a href="is_error_value.html">is_nul_byte</a></code> can be used to test for a nul
    byte.</p>
<p>It is recommended to use a new context for each request to ensure
    consistent state tracking. For safety, the context used for the request
    is closed when all references to the returned ‘recvAio’ are
    removed and the object is garbage collected.</p>
    </div>
    <div class="section level2">
    <h2 id="send-modes">Send Modes<a class="anchor" aria-label="anchor" href="#send-modes"></a></h2>



<p>The default mode ‘serial’ sends serialised R objects to ensure
    perfect reproducibility within R. When receiving, the corresponding mode
    ‘serial’ should be used. Custom serialization and unserialization
    functions for reference objects may be enabled by the function
    <code><a href="serial_config.html">serial_config</a></code>.</p>
<p>Mode ‘raw’ sends atomic vectors of any type as a raw byte vector,
    and must be used when interfacing with external applications or raw
    system sockets, where R serialization is not in use. When receiving, the
    mode corresponding to the vector sent should be used.</p>
    </div>
    <div class="section level2">
    <h2 id="signalling">Signalling<a class="anchor" aria-label="anchor" href="#signalling"></a></h2>



<p>By supplying a ‘conditionVariable’, when the receive is complete,
    the ‘conditionVariable’ is signalled by incrementing its value by
    1. This happens asynchronously and independently of the R execution
    thread.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># works if req and rep are running in parallel in different processes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="socket.html">socket</a></span><span class="op">(</span><span class="st">"req"</span>, listen <span class="op">=</span> <span class="st">"tcp://127.0.0.1:6546"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="socket.html">socket</a></span><span class="op">(</span><span class="st">"rep"</span>, dial <span class="op">=</span> <span class="st">"tcp://127.0.0.1:6546"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="reply.html">reply</a></span><span class="op">(</span><span class="fu"><a href="dot-context.html">.context</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span>, execute <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span>, timeout <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">aio</span> <span class="op">&lt;-</span> <span class="fu">request</span><span class="op">(</span><span class="fu"><a href="dot-context.html">.context</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span>, data <span class="op">=</span> <span class="fl">2022</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">aio</span><span class="op">$</span><span class="va">data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="close.html">close</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="close.html">close</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Signalling a condition variable</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="socket.html">socket</a></span><span class="op">(</span><span class="st">"req"</span>, listen <span class="op">=</span> <span class="st">"tcp://127.0.0.1:6546"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ctxq</span> <span class="op">&lt;-</span> <span class="fu"><a href="context.html">context</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="cv.html">cv</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">aio</span> <span class="op">&lt;-</span> <span class="fu">request</span><span class="op">(</span><span class="va">ctxq</span>, data <span class="op">=</span> <span class="fl">2022</span>, cv <span class="op">=</span> <span class="va">cv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="cv.html">until</a></span><span class="op">(</span><span class="va">cv</span>, <span class="fl">10L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="close.html">close</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The following should be run in another process</span></span></span>
<span class="r-in"><span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="socket.html">socket</a></span><span class="op">(</span><span class="st">"rep"</span>, dial <span class="op">=</span> <span class="st">"tcp://127.0.0.1:6546"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ctxp</span> <span class="op">&lt;-</span> <span class="fu"><a href="context.html">context</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="reply.html">reply</a></span><span class="op">(</span><span class="va">ctxp</span>, execute <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="close.html">close</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Charlie Gao, <img src="https://www.r-consortium.org/wp-content/uploads/sites/13/2016/09/RConsortium_Horizontal_Pantone.png" alt="R Consortium" width="100" height="22">.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

