% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/server.R
\name{handler_stream}
\alias{handler_stream}
\title{Create HTTP Streaming Handler}
\usage{
handler_stream(
  path,
  on_request,
  on_close = NULL,
  method = NULL,
  prefix = FALSE
)
}
\arguments{
\item{path}{URI path to match (e.g., "/events").}

\item{on_request}{Function called when a request arrives. Signature:
\verb{function(conn, req)} where \code{conn} is the connection object and \code{req}
is a list with \code{method}, \code{uri}, \code{headers}, \code{body}.}

\item{on_close}{[default NULL] Function called when the connection closes.
Signature: \verb{function(conn)}}

\item{method}{[default NULL] HTTP method to match. If NULL, matches any.}

\item{prefix}{[default FALSE] Logical, if TRUE matches path as a prefix.}
}
\value{
A handler object for use with \code{\link[=http_server]{http_server()}}.
}
\description{
Creates an HTTP streaming handler for Server-Sent Events (SSE) or chunked
transfer encoding responses.
}
\details{
HTTP streaming uses chunked transfer encoding. The first \verb{$send()} triggers
writing of HTTP headers. Headers cannot be modified after the first send.

For SSE, set the Content-Type header and use \code{\link[=format_sse]{format_sse()}} to format events:

\if{html}{\out{<div class="sourceCode">}}\preformatted{conn$set_header("Content-Type", "text/event-stream")
conn$set_header("Cache-Control", "no-cache")
conn$send(format_sse(data = "Hello!"))
}\if{html}{\out{</div>}}
}
\section{Connection Object}{

The \code{conn} object passed to callbacks has these methods:
\itemize{
\item \code{conn$send(data)}: Send data chunk to this connection. Character or raw.
\item \code{conn$broadcast(data)}: Send data to all connections on this handler.
Returns integer vector of results (0 = success).
\item \code{conn$close()}: Close the connection (sends terminal chunk).
\item \code{conn$set_status(code)}: Set HTTP status code (before first send).
\item \code{conn$set_header(name, value)}: Set response header (before first send).
\item \code{conn$id}: Unique connection identifier.
}
}

\examples{
# SSE endpoint that sends one event and closes
h <- handler_stream("/events", function(conn, req) {
  conn$set_header("Content-Type", "text/event-stream")
  conn$set_header("Cache-Control", "no-cache")
  conn$send(format_sse(data = "connected"))
  conn$close()
})

# Chat-style broadcast: each message goes to all other clients
h <- handler_stream("/chat",
  on_request = function(conn, req) {
    conn$set_header("Content-Type", "text/event-stream")
    conn$send(format_sse(data = "connected"))
    # When this client sends a message (via separate POST endpoint),
    # broadcast to all other connected clients:
    # conn$broadcast(format_sse(data = message))
  }
)

}
\seealso{
\code{\link[=format_sse]{format_sse()}} for formatting SSE events.
}
